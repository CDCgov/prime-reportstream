name: AZFunction-stop
description: stop Azure function on Friday in Test environment
inputs:
  resourceGroupName:
    required: true
  functionAppName:
    required: true
  functionName:
    required: true
 
runs:
  using: "composite"
  steps:
    - name: Stop funciton
      id: stop-function
      shell: pwsh
      run: |
        $findmodule = Get-Module -ListAvailable -Name Az.Functions
        if (!$findmodule) {
            write-host "Az.Functions module for PowershellAz not found - Will now update the agent by running command Install-Module -Name Az -AllowClobber -Force"
            Install-Module -Name Az -AllowClobber -Force
        }
        Get-AzFunctionApp -Name ${{ inputs.functionAppName }} -ResourceGroupName ${{ inputs.resourceGroupName }} | Stop-AzFunctionApp
       
      # $funcApp = Get-AzFunctionApp -ResourceGroupName ${{ inputs.resourceGroupName }} -Name ${{ inputs.functionAppName }}
      # $doesAppExist = ($funcApp -ne $null)
      # Write-Host "##vso[task.setvariable variable=DoesAppExist]$doesAppExist"
    # - uses: azure/appservice-settings@v1
    #   with:
    #     app-name: ${{ inputs.functionAppName }}
    #     app-settings-json: |
    #       [
    #         {
    #           "name": "AzureWebJobs.${{ inputs.functionName }}.Disabled",
    #           "value": true,
    #           "slotSetting": false
    #         }
    #       ]
    #   id: settings

  