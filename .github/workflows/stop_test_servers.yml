name: Stop Apps in Test server

on:
  workflow_dispatch:
  schedule:
   - cron: "0 0 * * SAT"
  push:
    branches:
      - feature/9537-schedulemaintenance_DemoandTest

jobs:
  alert_stale_branches:
    name: Stop Test Subscription apps
    runs-on: ubuntu-latest
    steps:
      - name: Check Out Changes
        uses: actions/checkout@8e5e7e5ab8b370d6c329ec480221332ada57f0ab
      
      # Login to Azure
      - uses: azure/login@92a5484dfaf04ca78a94597f4f19fea633851fa2
        with:
          creds: ${{ secrets.SERVICE_PRINCIPAL_CREDS }}

      # - name: Stop postgres
      #   uses: ./.github/actions/Stop-PostgresDB
      #   with:
      #     name: "pdhtest-pgsql-flex"
      #     resource-group: prime-data-hub-test
      #     subscription: OCIO-DMZ-C1
      #     pass: ${{ secrets.POSTGRESQL_Test_PWD }}
      #     creds: ${{ secrets.SERVICE_PRINCIPAL_CREDS }}

      - name: Stop function app
        uses: ./.github/actions/Stop-AzFunction
        with:
          resourceGroupName: prime-data-hub-test
          SubscriptionId: "7d1e3999-6577-4cd5-b296-f518e5c8e677"
          functionName: pdhtest-functionapp
          functionAppName: pdhtest-functionapp
          