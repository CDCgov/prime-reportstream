name: Test GHA on prime folder change

on:
  push:
    branches:
      - feature/165-Add-filter-to-build-router-action

env:
  # These are for CI and not credentials of any system
  DB_USER: prime
  DB_PASSWORD: changeIT!

jobs:
  pre_job:
    name: Pre Job
    runs-on: ubuntu-latest
    outputs: 
      has_router_change: ${{ steps.build_vars.outputs.has_router_change }}
      prime_router_change: ${{ steps.filter.outputs.prime_router_change }}
    steps:
      - name: "Check out changes"
        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b
      - name: Build vars
        id: build_vars
        uses: ./.github/actions/build-vars
      - name: "Check out changes"
        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b
      - name: path_filter
        id: filter
        uses: .github/actions/path-filters
        with:
          filters: |
            prime_router_change:
              - 'prime-router/**'

  build_router:
    name: Build Router
    runs-on: ubuntu-latest
    needs: pre_job
    if: | 
      ${{ needs.pre_job.outputs.has_router_change == 'true' }}
      ${{ needs.pre_job.outputs.prime_router_change == 'true' }}
      
    defaults:
      run:
        working-directory: prime-router

    steps:
      - name: "Check out changes"
        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b