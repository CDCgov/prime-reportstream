# To submit this to staging, run:
# ./prime login --env staging
# ./prime multiple-settings set --env staging --input ./settings/staging/0153-add-etor-service-receiver.yml
#
# You can also do all the above locally instead of staging, just take out --env staging.
#
# This FHIR ndjson (aka 'FHIR all on one line') data submission curl works for me, with a valid token in `TOK` env var:
#
# curl -X POST -H "authorization:bearer $TOK" -H "client:flexion.etor-service-sender"  -H "content-type:application/fhir+ndjson" --data-binary "@../../src/testIntegration/resources/datatests/HL7_to_FHIR/test.ndjson" "https://staging.prime.cdc.gov/api/waters"
#
---
- name: flexion
  description: Flexion, Inc.
  jurisdiction: FEDERAL
  countyName: "US"
  filters: null
  featureFlags: null
  receivers:
    - name: etor-service-receiver
      externalName: ETOR Service Receiver Channel from ReportStream
      organizationName: flexion
      topic: etor-ti
      customerStatus: active
      jurisdictionalFilter: [ "(%patientState.exists() and %patientState = 'IG')" ]
      qualityFilter: [ "(%patientState.exists() and %patientState = 'IG')" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<FHIR>
        schemaName: "metadata/fhir_transforms/receivers/fhir-transform-sample"
        useBatching: false
        type: "FHIR"
      transport: !<REST>
        reportUrl: "https://cdcti-staging-api.azurewebsites.net/v1/etor/demographics"
        authTokenUrl: "https://cdcti-staging-api.azurewebsites.net/v1/auth"
        headers: null
        type: "REST"
