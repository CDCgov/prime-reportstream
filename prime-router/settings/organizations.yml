---
#
# This file runs in environments (ie. your desktop) where the 'localhost' host name resolves
#
- name: waters
  description: Test Sender from Waters
  jurisdiction: FEDERAL
  senders:
    - name: default
      organizationName: waters
      topic: covid-19
      customerStatus: active
      schemaName: waters/waters-covid-19
      format: CSV
  receivers:
    - name: "giang"
      organizationName: "waters"
      topic: "covid-19"
      customerStatus: active
      translation:
        schemaName: "waters/waters-covid-19"
        format: "CSV"
        defaults: { }
        nameFormat: "STANDARD"
        receivingOrganization: null
        type: "CUSTOM"
      jurisdictionalFilter:
        - "hasAtLeastOneOf(waters_submitter, sender_id)"
        - "orEquals(patient_state, GH, ordering_facility_state, GH)"
      qualityFilter:
        - "allowAll()"
      reverseTheQualityFilter: false
      deidentify: true
      timing:
        operation: "MERGE"
        numberPerDay: 1440
        initialTime: "00:00"
        timeZone: "EASTERN"
        maxReportCount: 10000
      description: ""
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
      externalName: null
    - name: "giang2"
      organizationName: "waters"
      topic: "covid-19"
      customerStatus: active
      translation:
        schemaName: "waters/waters-covid-19"
        format: "CSV"
        defaults: { }
        nameFormat: "STANDARD"
        receivingOrganization: null
        type: "CUSTOM"
      jurisdictionalFilter:
        - "hasAtLeastOneOf(waters_submitter, sender_id)"
        - "orEquals(patient_state, GH, ordering_facility_state, GH)"
      qualityFilter:
        - "allowAll()"
      reverseTheQualityFilter: false
      deidentify: true
      timing:
        operation: "MERGE"
        numberPerDay: 1440
        initialTime: "00:00"
        timeZone: "EASTERN"
        maxReportCount: 10000
      description: ""
      transport:
        storageName: "PartnerStorage"
        containerName: "hhsprotect"
        type: "BLOBSTORE"
      externalName: null

# 'ignore' is a test organization, designed to be safely usable across all our environments.
# It has a bunch of receivers, each given a useful fake name, eg, named after the format of the data, in some cases.
# Please try to always make the receiver name identical to the county jurisdictionalFilter name.
# This is to aid in readability.
- name: ignore
  description: FOR TESTING ONLY
  jurisdiction: FEDERAL
  filters:
    - topic: covid-19
      jurisdictionalFilter: [ "matches(ordering_facility_state, IG)" ]
    - topic: monkeypox
      jurisdictionalFilter: [ "matches(ordering_facility_state, IG)" ]
    - topic: full-elr
      jurisdictionalFilter:
        - "(%performerState.exists() and %performerState = 'IG') or (%patientState.exists() and %patientState = 'IG')"
      qualityFilter:
        - "(%hl7MessageType.exists() and %hl7MessageType = 'R01')"
  senders:
    - name: default
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: primedatainput/pdi-covid-19
      format: CSV
    - name: ignore-full-elr      # Use this to test full-elr
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      schemaName: metadata/fhir_transforms/senders/default-sender-transform
      format: HL7
    - name: dev-simple-report      # Use this to test full-elr
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      schemaName: metadata/fhir_transforms/senders/SimpleReport/simple-report-sender-transform
      format: FHIR
    - name: ignore-etor-ti      # Use this to test etor-ti
      organizationName: ignore
      topic: etor-ti
      customerStatus: active
      schemaName: metadata/fhir_transforms/senders/default-sender-transform
      format: HL7
    - name: ignore-elr-elims      # Use this to test elr-elims
      organizationName: ignore
      topic: elr-elims
      customerStatus: active
      schemaName: metadata/fhir_transforms/senders/CDC-ELIMS/elims-sender-transform
      format: HL7
    - name: ignore-fhir      # Use this to test fhir
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      schemaName: metadata/fhir_transforms/senders/SimpleReport/simple-report-sender-transform
      format: FHIR
    - name: ignore-strac      # Use this to test sending strac data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: strac/strac-covid-19
      format: CSV
    - name: ignore-simple-report      # Use this to test sending simple_report data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: primedatainput/pdi-covid-19
      format: CSV
    - name: ignore-lifepoint      # Use this to test sending lifepoint data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: hl7/lifepoint-covid-19
      format: HL7
    - name: no-duplicates      # Use this to test sending simple_report with a dup check
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      schemaName: primedatainput/pdi-covid-19
      allowDuplicates: false    # Duplicate data causes errors!!
      format: CSV
    - name: ignore-waters      # Use this to test sending waters data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: waters/waters-covid-19
      format: CSV
    - name: ignore-empty      # Use this to test sending data from the 'empty' schema
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      schemaName: empty
      format: CSV
    - name: ignore-hl7      # Use this to test sending data from the HL7 schema
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: hl7/test-covid-19
      format: HL7
    - name: ignore-monkeypox
      organizationName: ignore
      topic: monkeypox
      customerStatus: inactive
      schemaName: monkeypox
      format: HL7
  receivers:
    - name: CSV
      externalName: The CSV receiver for Ignore
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, CSV)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19
        format: CSV
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: FULL_ELR
      externalName: Ignore FULL_ELR
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'IG') or (%patientState.exists() and %patientState = 'IG')" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/receivers/STLTs/CO/CO"
        useTestProcessingMode: false
        useBatchHeaders: true
        type: "HL7"
        receivingApplicationName: "CO-ELR"
        receivingFacilityName: "CO"
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: ETOR_TI
      externalName: Ignore ETOR_TI
      organizationName: ignore
      topic: etor-ti
      customerStatus: active
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'IG') or (%patientState.exists() and %patientState = 'IG')" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/receivers/STLTs/CO/CO"
        useTestProcessingMode: false
        useBatchHeaders: true
        type: "HL7"
        receivingApplicationName: "CO-ETOR"
        receivingFacilityName: "CO"
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: ELR_ELIMS
      externalName: Ignore ELR_ELIMS
      organizationName: ignore
      topic: elr-elims
      customerStatus: active
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'IG') or (%patientState.exists() and %patientState = 'IG')" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/ORU_R01/ORU_R01-base"
        useBatchHeaders: true
        type: "HL7"
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: FULL_ELR_FHIR
      externalName: Ignore FULL_ELR_FHIR
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'IG') or (%patientState.exists() and %patientState = 'IG')" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<FHIR>
        # Uncomment next line to verify fhir receiver transforms
        # schemaName: "metadata/fhir_transforms/receivers/fhir-transform-sample"
        type: "FHIR"
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7
      externalName: Ignore HL7
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: fl/fl-covid-19
        format: HL7
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_MONKEYPOX
      externalName: Ignore Monkeypox
      organizationName: ignore
      topic: monkeypox
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_MONKEYPOX)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: monkeypox
        format: HL7
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH
      externalName: Ignore HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: HL7_BATCH
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_PPK
      externalName: Ignore HL7_BATCH PPK
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: HL7_BATCH
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP-PPK
    - name: HL7_BATCH_PEM
      externalName: Ignore HL7_BATCH PEM
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: HL7_BATCH
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP-PEM
    - name: AS2
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, AS2)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
    - name: HL7_NULL     # Null Transport.
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_NULL)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: tx/tx-covid-19
        format: HL7_BATCH
    - name: BLOBSTORE
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, BLOBSTORE)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: hhsprotect/hhsprotect-covid-19
        format: CSV
      transport:
        type: BLOBSTORE
        storageName: PartnerStorage
        containerName: hhsprotect
    - name: SFTP_FAIL    # If you put "FAIL" in the receiver name, then the happy-path tests in TestReportStream will ignore them.
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, SFTP_FAIL)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: CSV
      transport:
        type: SFTP
        host: sftp_FAIL_BAD
        port: 2222
        filePath: ./upload_FAIL
    - name: QUALITY_PASS
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_PASS, removed)" ]
      qualityFilter:
        - hasValidDataFor(message_id,ordering_facility_county,ordering_facility_state)
        - hasAtLeastOneOf(message_id,blankField)
        - matches(ordering_facility_county, QUALITY_PASS)
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: QUALITY_REVERSED
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_REVERSED, kept)" ]
      qualityFilter:
        - hasValidDataFor(message_id,ordering_facility_county,ordering_facility_state)
        - hasAtLeastOneOf(message_id,blankField)
        - matches(ordering_facility_county, QUALITY_REVERSED)
      # Get 'not(qualityFilter)'
      reverseTheQualityFilter: true
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: QUALITY_ALL
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_ALL)" ]
      qualityFilter: [ "allowAll()" ]
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: QUALITY_FAIL
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_FAIL)" ]
      qualityFilter: [ "hasValidDataFor(blankField)", "hasAtLeastOneOf(message_id,blankField)" ]
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: OTC_PROCTORED_YYY
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, OTC_PROCTORED)" ]
      qualityFilter: [ "matches(test_authorized_for_otc, Y)","matches(test_authorized_for_home, Y)","matches(test_authorized_for_unproctored, Y)" ]
      translation:
        type: "CUSTOM"
        schemaName: "hhsprotect/hhsprotect-covid-19"
        format: "CSV"
      deidentify: true
    - name: OTC_PROCTORED_NYY
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, OTC_PROCTORED)" ]
      qualityFilter: [ "matches(test_authorized_for_otc, N)","matches(test_authorized_for_home, Y)","matches(test_authorized_for_unproctored, Y)" ]
      translation:
        type: "CUSTOM"
        schemaName: "hhsprotect/hhsprotect-covid-19"
        format: "CSV"
      deidentify: true
    - name: OTC_PROCTORED_NUNKUNK
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, OTC_PROCTORED)" ]
      qualityFilter: [ "matches(test_authorized_for_otc, N)","matches(test_authorized_for_home, UNK)","matches(test_authorized_for_unproctored, UNK)" ]
      translation:
        type: "CUSTOM"
        schemaName: "hhsprotect/hhsprotect-covid-19"
        format: "CSV"
      deidentify: true
    - name: EVERY_5_MINS
      externalName: Batches and Sends every 5 minutes.  For Load testing.
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, EVERY_5_MINS)" ]
      timing:
        operation: MERGE
        numberPerDay: 288 # Every 5 minutes
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: EVERY_15_MINS
      externalName: Batches and Sends every 15 minutes.  For Load testing.
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, EVERY_15_MINS)" ]
      timing:
        operation: MERGE
        numberPerDay: 96 # Every 15 minutes
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: EVERY_60_MINS
      externalName: Batches and Sends every 60 minutes.  For Load testing.
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, EVERY_60_MINS)" ]
      timing:
        operation: MERGE
        numberPerDay: 24 # Every 60 minutes
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: SETTINGS_TEST
      externalName: Used to test putting sender settings into the data, using ignore.ignore-empty
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, SETTINGS_TEST)" ]
      qualityFilter: [ "allowAll()" ]
      # These three filters must match the settings for the ignore.ignore-empty Sender.
      routingFilter:
        - matches(sender_fullname, ignore.ignore-empty)
        - matches(sender_orgname, ignore)
      processingModeFilter:
        # Because ignore.ignore-empty has customerStatus = active
        - matches(processing_mode_code, P)
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_LOCAL_TIME_CONVERT
      externalName: LocalTime HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timeZone: PACIFIC
      dateTimeFormat: LOCAL
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        format: HL7_BATCH
        receivingApplicationName: IG-PACIFIC-LOCAL-TIME
        convertDateTimesToReceiverLocalTime: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_OFFSET_TIME_CONVERT
      externalName: Offset HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timeZone: PACIFIC
      dateTimeFormat: OFFSET
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        format: HL7_BATCH
        receivingApplicationName: IG-PACIFIC-OFFSET
        convertDateTimesToReceiverLocalTime: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_OFFSET_TIME_UTC
      externalName: Offset UTC HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timeZone: UTC
      dateTimeFormat: OFFSET
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        format: HL7_BATCH
        receivingApplicationName: IG-UTC-OFFSET
        convertDateTimesToReceiverLocalTime: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: REST_TEST
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, REST_TEST)" ]
      translation:
        type: HL7
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
        timeZone: EASTERN
      transport:
        type: REST
        authTokenUrl: http://rest-webservice:3001/token
        reportUrl: http://rest-webservice:3001/report
        headers:
          UPHN-INFOMAP: '{}'
    - name: SOAP_TEST
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, REST_TEST)" ]
      translation:
        type: HL7
      transport:
        type: SOAP
        endpoint: "http://soap-webservice:8080/castlemock/mock/soap/project/eUAvaN/BasicHttpBinding_IUploadFile"
        soapAction: "" #"http://nedss.state.pa.us/2012/B01/elrwcf/IUploadFile/UploadFiles"
        credentialName: null
      #        namespaces:
      #          "xmlns:elr": "http://nedss.state.pa.us/2012/B01/elrwcf"
      timing:
        operation: MERGE
        numberPerDay: 1440
        initialTime: 00:00
    - name: GAEN_TEST
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, REST_TEST)" ]
      timing: null
      translation:
        type: GAEN
      transport:
        type: GAEN
        uuidFormat: WA_NOTIFY
        uuidIV: 1
        apiUrl: ""
    - name: SFTP_TEST
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, SFTP_TEST)" ]
      timing: null
      translation:
        type: HL7
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP


- name: historytest
  description: FOR TESTING SUBMISSION HISTORY
  jurisdiction: FEDERAL
  senders:
    - name: default
      organizationName: historytest
      topic: covid-19
      customerStatus: active
      schemaName: primedatainput/pdi-covid-19
      format: CSV

- name: simple_report
  description: PRIME's POC testing app
  jurisdiction: FEDERAL
  senders:
    - name: default
      organizationName: simple_report
      topic: covid-19
      customerStatus: active
      schemaName: primedatainput/pdi-covid-19
      format: CSV
    - name: csvuploader
      organizationName: simple_report
      topic: covid-19
      customerStatus: active
      schemaName: upload-covid-19
      format: CSV

- name: hcintegrations
  description: Healthcare Integrations
  jurisdiction: FEDERAL
  senders:
    - name: default
      organizationName: hcintegrations
      topic: covid-19
      customerStatus: active
      schemaName: hl7/hcintegrations-covid-19
      format: HL7

- name: oh-doh
  description: Ohio Department of Health
  jurisdiction: STATE
  stateCode: OH
  receivers:
    - name: elr
      organizationName: oh-doh
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter:
        - matches(ordering_facility_state, OH)
      translation:
        type: HL7
        useBatchHeaders: true
        suppressQstForAoe: true
        receivingApplicationName: OHDOH
        receivingApplicationOID: 2.16.840.1.114222.4.1.3674
        receivingFacilityName: OHDOH
        receivingFacilityOID: 2.16.840.1.114222.4.1.3674
        reportingFacilityName: CDC PRIME
        reportingFacilityId: 36DSMP9999
        nameFormat: ohio
        suppressHl7Fields: OBX-23-11, MSH-19-1, MSH-19-2, MSH-19-3
        # turn off UNK and ASKU for this field
        useBlankInsteadOfUnknown: patient_race
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
        timeZone: EASTERN
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP

- name: hi-phd
  description: Hawaii Public Health Department
  jurisdiction: STATE
  stateCode: HI
  receivers:
    - name: elr
      organizationName: hi-phd
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter:
        - orEquals(ordering_facility_state, HI, patient_state, HI)
      translation:
        type: HL7
        useBatchHeaders: true
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
        timeZone: EASTERN
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP


- name: ak-phd
  description: Alaska Public Health Department
  jurisdiction: STATE
  stateCode: AK
  receivers:
    - name: elr
      organizationName: ak-phd
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter:
        - orEquals(ordering_facility_state, AK, patient_state, AK)
      translation:
        type: HL7
        useBatchHeaders: true
        suppressHl7Fields: PID-5-7, ORC-12-1, OBR-16-1
        replaceValue:
          PID-22-3: CDCREC
      timing:
        operation: MERGE
        numberPerDay: 1440
        initialTime: 00:00
        timeZone: EASTERN
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP

- name: md-phd
  description: TEST Maryland Public Health Department
  jurisdiction: STATE
  filters:
    - topic: covid-19
      jurisdictionalFilter: [ "orEquals(ordering_facility_state, MD, patient_state, MD)" ]
    - topic: full-elr
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'MD') or (%patientState.exists() and %patientState = 'MD')" ]
  stateCode: MD
  receivers:
    - name: elr
      organizationName: md-phd
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter:
        - orEquals(patient_state, MD, ordering_facility_state, MD)
      translation:
        type: HL7
        useBatchHeaders: true
      timing:
        operation: MERGE
        numberPerDay: 1440
        initialTime: 00:00
        timeZone: EASTERN
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
# THIS ORGANIZATION IS FOR DEVELOPMENT PURPOSES ONLY - CHANGING IT WILL HAVE NO IMPACT ON TESTS
- name: development
  description: FOR DEVELOPMENT PURPOSES ONLY
  jurisdiction: FEDERAL
  senders:
    - name: dev-elims
      organizationName: development
      topic: full-elr
      customerStatus: active
      schemaName: metadata/fhir_transforms/senders/CDC-ELIMS/elims-sender-transform
      format: HL7
  receivers:
    # THIS RECEIVER IS NOT USED IN ANY TESTS AND CAN BE UPDATED TO YOUR HEARTS CONTENT
    - name: DEV_FULL_ELR
      externalName: Ignore FULL_ELR Development
      organizationName: development
      topic: full-elr
      customerStatus: active
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'CA') or (%patientState.exists() and %patientState = 'CA')" ]
      qualityFilter:
        - "(%hl7MessageType.exists() and %hl7MessageType = 'R01')"
        # Flu B Test Performed LOINCs 85478-6, 76080-1, 92141-1, 80383-3, 82170-2
        # Flu A Test Performed LOINCs 85477-8, 76078-5, 77026-3, 77028-9, 77027-1, 92142-9, 80382-5, 82166-0, 82167-8, 82169-4, 82168-6, 92809-3, 92808-5
        # Special Snowflake LOINC - 95423-0 (Snomed CT code determines if it was the flu A or flu B result)
        - "(%hl7MessageType.exists() and %hl7MessageType = 'R01')"
        # Every order has at least an order-test-date (ORC-15), specimen_collection_date_time (SPM-17-1, OBR-7, OBR-8, OBX-14) or test-result-date (OBX-19)
        - "Bundle.entry.resource.ofType(DiagnosticReport).where( basedOn.resolve().extension('https://reportstream.cdc.gov/fhir/StructureDefinition/effective-date').empty() and specimen.resolve().collection.collected.empty() and effective.empty() and issued.empty() and result.resolve().effective.empty()).count() = 0"
        # Patient has at least a street address(PID-11-1), postal code (PID-11-5),phone(PID-13) or email(PID-13-4)
        - "Bundle.entry.resource.ofType(Patient).where(address.line[0].empty() and address.postalCode.empty() and telecom.where(system = 'phone').value.empty() and telecom.where(system = 'email').value.empty()).count() = 0"
        # Message id is not empty (MSH-10)
        - "Bundle.identifier.value.empty().not()"
        # Equipment model (OBX-17-2) and test result (OBX-5) are not empty
        - "Bundle.entry.resource.ofType(DiagnosticReport).result.resolve().where(method.empty() or value.coding.code.empty()).count() = 0"
        #  Specimen type (SPM-4) is not empty
        - "Bundle.entry.resource.ofType(Specimen).where(type.empty()).count() = 0"
        # Patient's last name (PID-5-1), first name (PID-5-2) and date of birth (PID-7)are not empty
        - "Bundle.entry.resource.ofType(Patient).where(name.family.empty() or name.given.empty() or birthDate.empty()).count() = 0"
        # Ordering provider (OBR-16-1) exists
        - "Bundle.entry.resource.ofType(ServiceRequest).where(requester.resolve().practitioner.resolve().name.family.empty()).count() = 0"
        - "Bundle.entry.resource.ofType(ServiceRequest).performer.resolve().identifier.value.getIdType() = 'CLIA'"
        - "Bundle.entry.resource.ofType(ServiceRequest).requester.resolve().organization.resolve().identifier.value.getIdType() = 'CLIA'"
      conditionFilter:
        # Accept all conditions except Covid results in the LIVD look up table
        # Covid flows through the Covid pipeline
        - "%resource.livdTableLookup('Component').contains('coronavirus').not()"
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/receivers/STLTs/CA/CA-receiver-transform"
        useTestProcessingMode: false
        useBatchHeaders: true
        type: "HL7"
        receivingApplicationName: ""
        receivingFacilityName: ""
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    # THIS RECEIVER IS NOT USED IN ANY TESTS AND CAN BE UPDATED TO YOUR HEARTS CONTENT
    - name: RADX_MARS
      externalName: RADx_MARs Test
      organizationName: development
      topic: full-elr
      customerStatus: active
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'RADX') or (%patientState.exists() and %patientState = 'RADX')" ]
      qualityFilter:
        - "Bundle.identifier.value.empty().not()"
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/ORU_R01/RADx_MARS/RADx_MARS-base"
        useTestProcessingMode: false
        useBatchHeaders: true
        type: "HL7"
        receivingApplicationName: ""
        receivingFacilityName: ""
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: RADX_MARS_NO_PII
      externalName: RADx_MARs NO PII
      organizationName: development
      topic: full-elr
      customerStatus: active
      jurisdictionalFilter: [ "(%performerState.exists() and %performerState = 'RADX') or (%patientState.exists() and %patientState = 'RADX')" ]
      qualityFilter:
        - "Bundle.identifier.value.empty().not()"
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/ORU_R01/RADx_MARS/RADx_MARS-base-deidentified"
        useTestProcessingMode: false
        useBatchHeaders: true
        type: "HL7"
        receivingApplicationName: ""
        receivingFacilityName: ""
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: DEV_ELIMS
      externalName: ELIMS Development
      organizationName: development
      topic: elr-elims
      customerStatus: inactive
      jurisdictionalFilter: [ "true" ]
      qualityFilter:
        - "true"
      processingModeFilter: [ "true" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/ORU_R01/ORU_R01-base"
        useTestProcessingMode: false
        useBatchHeaders: false
        type: "HL7"
        receivingApplicationName: ""
        receivingFacilityName: ""
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: DEV_ELIMS_FHIR
      externalName: ELIMS Development
      organizationName: development
      topic: elr-elims
      customerStatus: inactive
      jurisdictionalFilter: [ "true" ]
      qualityFilter:
        - "true"
      processingModeFilter: [ "true" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<FHIR>
        useBatching: false
        type: "FHIR"
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
