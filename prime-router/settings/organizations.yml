---
#
# This file runs in environments (ie. your desktop) where the 'localhost' host name resolves
#
- name: waters
  description: Test Sender from Waters
  jurisdiction: FEDERAL
  senders:
    - name: default
      organizationName: waters
      topic: covid-19
      customerStatus: active
      schemaName: waters/waters-covid-19
      format: CSV
  receivers:
    - name: "giang"
      organizationName: "waters"
      topic: "covid-19"
      customerStatus: active
      translation:
        schemaName: "waters/waters-covid-19"
        format: "CSV"
        defaults: { }
        nameFormat: "STANDARD"
        receivingOrganization: null
        type: "CUSTOM"
      jurisdictionalFilter:
        - "hasAtLeastOneOf(waters_submitter, sender_id)"
        - "orEquals(patient_state, GH, ordering_facility_state, GH)"
      qualityFilter:
        - "allowAll()"
      reverseTheQualityFilter: false
      deidentify: true
      timing:
        operation: "MERGE"
        numberPerDay: 1440
        initialTime: "00:00"
        timeZone: "EASTERN"
        maxReportCount: 10000
      description: ""
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
      externalName: null
    - name: "giang2"
      organizationName: "waters"
      topic: "covid-19"
      customerStatus: active
      translation:
        schemaName: "waters/waters-covid-19"
        format: "CSV"
        defaults: { }
        nameFormat: "STANDARD"
        receivingOrganization: null
        type: "CUSTOM"
      jurisdictionalFilter:
        - "hasAtLeastOneOf(waters_submitter, sender_id)"
        - "orEquals(patient_state, GH, ordering_facility_state, GH)"
      qualityFilter:
        - "allowAll()"
      reverseTheQualityFilter: false
      deidentify: true
      timing:
        operation: "MERGE"
        numberPerDay: 1440
        initialTime: "00:00"
        timeZone: "EASTERN"
        maxReportCount: 10000
      description: ""
      transport:
        storageName: "PartnerStorage"
        containerName: "hhsprotect"
        type: "BLOBSTORE"
      externalName: null

# 'ignore' is a test organization, designed to be safely usable across all our environments.
# It has a bunch of receivers, each given a useful fake name, eg, named after the format of the data, in some cases.
# Please try to always make the reciever name identical to the county jurisdictionalFilter name.
# This is to aid in readability.
- name: ignore
  description: FOR TESTING ONLY
  jurisdiction: FEDERAL
  filters:
    - topic: covid-19
      jurisdictionalFilter: [ "matches(ordering_facility_state, IG)" ]
    - topic: monkeypox
      jurisdictionalFilter: [ "matches(ordering_facility_state, IG)" ]
    - topic: full-elr
      jurisdictionalFilter:
        - "%performerState = 'IG' or %patientState = 'IG'"
      qualityFilter:
        - "%hl7MessageType = 'R01'"
  senders:
    - name: default
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: primedatainput/pdi-covid-19
      format: CSV
    - name: ignore-full-elr      # Use this to test full-elr
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      format: HL7
    - name: ignore-fhir      # Use this to test fhir
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      format: FHIR
    - name: ignore-strac      # Use this to test sending strac data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: strac/strac-covid-19
      format: CSV
    - name: ignore-simple-report      # Use this to test sending simple_report data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: primedatainput/pdi-covid-19
      format: CSV
    - name: ignore-lifepoint      # Use this to test sending lifepoint data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: hl7/lifepoint-covid-19
      format: HL7
    - name: no-duplicates      # Use this to test sending simple_report with a dup check
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      schemaName: primedatainput/pdi-covid-19
      allowDuplicates: false    # Duplicate data causes errors!!
      format: CSV
    - name: ignore-waters      # Use this to test sending waters data
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: waters/waters-covid-19
      format: CSV
    - name: ignore-empty      # Use this to test sending data from the 'empty' schema
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      schemaName: empty
      format: CSV
    - name: ignore-hl7      # Use this to test sending data from the HL7 schema
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      schemaName: hl7/test-covid-19
      format: HL7
    - name: ignore-monkeypox
      organizationName: ignore
      topic: monkeypox
      customerStatus: inactive
      schemaName: monkeypox
      format: HL7
  receivers:
    - name: CSV
      externalName: The CSV receiver for Ignore
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, CSV)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19
        format: CSV
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: FULL_ELR
      externalName: Ignore FULL_ELR
      organizationName: ignore
      topic: full-elr
      customerStatus: active
      jurisdictionalFilter: [ "%performerState = 'IG' or %patientState = 'IG'" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation: !<HL7>
        schemaName: "metadata/hl7_mapping/STLTs/CO/CO"
        useTestProcessingMode: false
        useBatchHeaders: true
        type: "HL7"
        receivingApplicationName: "CO-ELR"
        receivingFacilityName: "CO"
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7
      externalName: Ignore HL7
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: fl/fl-covid-19
        format: HL7
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_MONKEYPOX
      externalName: Ignore Monkeypox
      organizationName: ignore
      topic: monkeypox
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_MONKEYPOX)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: monkeypox
        format: HL7
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH
      externalName: Ignore HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: HL7_BATCH
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_PPK
      externalName: Ignore HL7_BATCH PPK
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: HL7_BATCH
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP-PPK
    - name: HL7_BATCH_PEM
      externalName: Ignore HL7_BATCH PEM
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: HL7_BATCH
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP-PEM
    - name: AS2
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, AS2)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
    - name: HL7_NULL     # Null Transport.
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_NULL)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: tx/tx-covid-19
        format: HL7_BATCH
    - name: BLOBSTORE
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, BLOBSTORE)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: hhsprotect/hhsprotect-covid-19
        format: CSV
      transport:
        type: BLOBSTORE
        storageName: PartnerStorage
        containerName: hhsprotect
    - name: SFTP_FAIL    # If you put "FAIL" in the receiver name, then the happy-path tests in TestReportStream will ignore them.
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, SFTP_FAIL)" ]
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: az/az-covid-19-hl7
        format: CSV
      transport:
        type: SFTP
        host: sftp_FAIL_BAD
        port: 2222
        filePath: ./upload_FAIL
    - name: QUALITY_PASS
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_PASS, removed)" ]
      qualityFilter:
        - hasValidDataFor(message_id,ordering_facility_county,ordering_facility_state)
        - hasAtLeastOneOf(message_id,blankField)
        - matches(ordering_facility_county, QUALITY_PASS)
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: QUALITY_REVERSED
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_REVERSED, kept)" ]
      qualityFilter:
        - hasValidDataFor(message_id,ordering_facility_county,ordering_facility_state)
        - hasAtLeastOneOf(message_id,blankField)
        - matches(ordering_facility_county, QUALITY_REVERSED)
      # Get 'not(qualityFilter)'
      reverseTheQualityFilter: true
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: QUALITY_ALL
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_ALL)" ]
      qualityFilter: [ "allowAll()" ]
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: QUALITY_FAIL
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, QUALITY_FAIL)" ]
      qualityFilter: [ "hasValidDataFor(blankField)", "hasAtLeastOneOf(message_id,blankField)" ]
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
    - name: OTC_PROCTORED_YYY
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, OTC_PROCTORED)" ]
      qualityFilter: [ "matches(test_authorized_for_otc, Y)","matches(test_authorized_for_home, Y)","matches(test_authorized_for_unproctored, Y)" ]
      translation:
        type: "CUSTOM"
        schemaName: "hhsprotect/hhsprotect-covid-19"
        format: "CSV"
      deidentify: true
    - name: OTC_PROCTORED_NYY
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, OTC_PROCTORED)" ]
      qualityFilter: [ "matches(test_authorized_for_otc, N)","matches(test_authorized_for_home, Y)","matches(test_authorized_for_unproctored, Y)" ]
      translation:
        type: "CUSTOM"
        schemaName: "hhsprotect/hhsprotect-covid-19"
        format: "CSV"
      deidentify: true
    - name: OTC_PROCTORED_NUNKUNK
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, OTC_PROCTORED)" ]
      qualityFilter: [ "matches(test_authorized_for_otc, N)","matches(test_authorized_for_home, UNK)","matches(test_authorized_for_unproctored, UNK)" ]
      translation:
        type: "CUSTOM"
        schemaName: "hhsprotect/hhsprotect-covid-19"
        format: "CSV"
      deidentify: true
    - name: EVERY_5_MINS
      externalName: Batches and Sends every 5 minutes.  For Load testing.
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, EVERY_5_MINS)" ]
      timing:
        operation: MERGE
        numberPerDay: 288 # Every 5 minutes
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: EVERY_15_MINS
      externalName: Batches and Sends every 15 minutes.  For Load testing.
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, EVERY_15_MINS)" ]
      timing:
        operation: MERGE
        numberPerDay: 96 # Every 15 minutes
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: EVERY_60_MINS
      externalName: Batches and Sends every 60 minutes.  For Load testing.
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, EVERY_60_MINS)" ]
      timing:
        operation: MERGE
        numberPerDay: 24 # Every 60 minutes
        initialTime: 00:00
      translation:
        type: HL7
        useBatchHeaders: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: SETTINGS_TEST
      externalName: Used to test putting sender settings into the data, using ignore.ignore-empty
      organizationName: ignore
      topic: covid-19
      customerStatus: active
      jurisdictionalFilter: [ "matches(ordering_facility_county, SETTINGS_TEST)" ]
      qualityFilter: [ "allowAll()" ]
      # These three filters must match the settings for the ignore.ignore-empty Sender.
      routingFilter:
        - matches(sender_fullname, ignore.ignore-empty)
        - matches(sender_orgname, ignore)
      processingModeFilter:
        # Because ignore.ignore-empty has customerStatus = active
        - matches(processing_mode_code, P)
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: CUSTOM
        schemaName: empty
        format: CSV
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_LOCAL_TIME_CONVERT
      externalName: LocalTime HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timeZone: PACIFIC
      dateTimeFormat: LOCAL
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        format: HL7_BATCH
        receivingApplicationName: IG-PACIFIC-LOCAL-TIME
        convertDateTimesToReceiverLocalTime: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_OFFSET_TIME_CONVERT
      externalName: Offset HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timeZone: PACIFIC
      dateTimeFormat: OFFSET
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        format: HL7_BATCH
        receivingApplicationName: IG-PACIFIC-OFFSET
        convertDateTimesToReceiverLocalTime: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: HL7_BATCH_OFFSET_TIME_UTC
      externalName: Offset UTC HL7_BATCH
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, HL7_BATCH)" ]
      timeZone: UTC
      dateTimeFormat: OFFSET
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
      translation:
        type: HL7
        format: HL7_BATCH
        receivingApplicationName: IG-UTC-OFFSET
        convertDateTimesToReceiverLocalTime: true
      transport:
        type: SFTP
        host: sftp
        port: 22
        filePath: ./upload
        credentialName: DEFAULT-SFTP
    - name: REST_TEST
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, REST_TEST)" ]
      translation:
        type: HL7
      timing:
        operation: MERGE
        numberPerDay: 1440 # Every minute
        initialTime: 00:00
        timeZone: EASTERN
      transport:
        type: REST
        authTokenUrl: http://rest-webservice:3001/token
        reportUrl:  http://rest-webservice:3001/report
        headers:
          UPHN-INFOMAP: '{}'
    - name: SOAP_TEST
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, REST_TEST)" ]
      translation:
        type: HL7
      transport:
        type: SOAP
        endpoint: "http://soap-webservice:8080/castlemock/mock/soap/project/eUAvaN/BasicHttpBinding_IUploadFile"
        soapAction: "" #"http://nedss.state.pa.us/2012/B01/elrwcf/IUploadFile/UploadFiles"
        credentialName: null
#        namespaces:
#          "xmlns:elr": "http://nedss.state.pa.us/2012/B01/elrwcf"
      timing:
        operation: MERGE
        numberPerDay: 1440
        initialTime: 00:00
    - name: GAEN_TEST
      organizationName: ignore
      topic: covid-19
      customerStatus: inactive
      jurisdictionalFilter: [ "matches(ordering_facility_county, REST_TEST)" ]
      timing: null
      translation:
       type: GAEN
      transport:
       type: GAEN
       uuidFormat: WA_NOTIFY
       uuidIV: 1
       apiUrl: ""

- name: historytest
  description: FOR TESTING SUBMISSION HISTORY
  jurisdiction: FEDERAL
  senders:
    - name: default
      organizationName: historytest
      topic: covid-19
      customerStatus: active
      schemaName: primedatainput/pdi-covid-19
      format: CSV