# Alabama Public Health Lab settings for staging
#
# To submit to staging, run:
# ./prime login --env staging
# ./prime multiple-settings set --env staging --input ./settings/STLTs/AL/al-phl.yml
#
# Receiver settings
# - Name: Natus.AL.STAG
# - OOID: 2.16.840.1.114222.4.3.26.1.1
#
# You may use the below curl command to submit a request. You just need to replace the TOKEN with the auth JWT and the path to the FHIR message to send 
# curl -H 'Authorization: Bearer TOKEN' -H 'Client: flexion.etor-service-sender' -H 'Content-Type: application/fhir+ndjson' --data-binary '@/path/to/fhir/oml.fhir' 'https://staging.prime.cdc.gov/api/waters'
- name: "al-phl"
  description: "Alabama Public Health Lab"
  jurisdiction: "STATE"
  stateCode: "AL"
  senders:
    - name: "etor-nbs-results"
      organizationName: "al-phl"
      topic: "etor-ti"
      customerStatus: "active"
      format: "HL7"
  receivers:
    - name: "etor-nbs-orders"
      organizationName: "al-phl"
      topic: "etor-ti"
      customerStatus: "active"
      jurisdictionalFilter:
        - "Bundle.entry.resource.ofType(MessageHeader).event.code = 'O21'"  # OML_O21
        - "Bundle.entry.resource.ofType(MessageHeader).meta.tag.where(system = 'http://localcodes.org/ETOR').code = 'ETOR'"
        - "Bundle.entry.resource.ofType(MessageHeader).destination.receiver.resolve().identifier.where(value = '2.16.840.1.114222.4.3.26.1.1').exists()"
      qualityFilter:
        - "true"
      processingModeFilter:
        - "Bundle.entry.resource.ofType(MessageHeader).meta.tag.where(system = 'http://terminology.hl7.org/CodeSystem/v2-0103').code.exists() and Bundle.entry.resource.ofType(MessageHeader).meta.tag.where(system = 'http://terminology.hl7.org/CodeSystem/v2-0103').code = 'P'"
      timing:
        operation: "MERGE"
        numberPerDay: 1440
        initialTime: "00:00"
        timeZone: "EASTERN"
        maxReportCount: 100
      translation:
        type: "HL7"
        schemaName: "classpath:/metadata/hl7_mapping/receivers/Flexion/TILabOrder.yml"
        useBatchHeaders: false
        receivingApplicationName: "AL-PHL"
        receivingFacilityName: "AL"
      transport:
        host: "ph.state.al.us"
        port: "22"
        filePath: "./"
        credentialName: null
        type: "SFTP"
