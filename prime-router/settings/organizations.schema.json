{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "array",
    "items": {
        "$ref": "#/definitions/ReportStreamSettings"
    },
    "definitions": {
        "ReportStreamSettings": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "name": {
                    "type": "string"
                },
                "description": {
                    "type": "string"
                },
                "jurisdiction": {
                    "$ref": "#/definitions/Jurisdiction"
                },
                "senders": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Sender"
                    }
                },
                "receivers": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Receiver"
                    }
                },
                "filters": {
                    "type": ["array", "null"],
                    "items": {
                        "$ref": "#/definitions/Filter"
                    }
                },
                "featureFlags": {
                    "type": ["array", "null"]
                },
                "stateCode": {
                    "type": ["string", "null"]
                },
                "countyName": {
                    "type": ["string", "null"]
                }
            },
            "required": [
                "jurisdiction",
                "name"
            ],
            "if": {
                "properties": {
                    "jurisdiction": { "const": "FEDERAL" }
                }
            },
            "then": {
                "allOf": [
                    {"not": { "required": [ "stateCode"] }},
                    {"not": { "required": [ "countyName"] }}
                ]
            },
            "else": {
                "if": {
                    "properties": {
                        "jurisdiction": { "const": "STATE" }
                    }
                },
                "then": {
                    "allOf": [
                        { "required": [ "stateCode"] },
                        {"not": { "required": [ "countyName"] }}
                    ]
                },
                "else": {
                    "if": {
                        "properties": {
                            "jurisdiction": { "const": "COUNTY" }
                        }
                    },
                    "then": {
                        "allOf": [
                            {
                                "required": [
                                    "stateCode",
                                    "countyName"
                                ],
                                "errorMessage": "For COUNTY jurisdiction, both 'stateCode' and 'countyName' is required"
                            }
                        ]
                    }
                }
            },
            "title": "ReportStreamSettings"
        },
        "Filter": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "topic": {
                    "$ref": "#/definitions/Topic"
                },
                "jurisdictionalFilter": {
                    "type": ["array", "null"],
                    "items": {
                        "type": "string"
                    }
                },
                "qualityFilter": {
                    "type": ["array", "null"],
                    "items": {
                        "type": "string"
                    }
                },
                "processingModeFilter": {
                    "type": ["array", "null"],
                    "items": {
                        "type": "string"
                    }
                },
                "conditionFilter": {
                    "type": ["array", "null"],
                    "items": {
                        "type": "string"
                    }
                },
                "routingFilter": {
                    "type": ["array", "null"],
                    "items": {
                        "type": "string"
                    }
                },
                "mappedConditionFilter": {
                    "type": ["array", "null"],
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "jurisdictionalFilter",
                "topic"
            ],
            "title": "Filter"
        },
        "Receiver": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "name": {
                    "type": "string"
                },
                "organizationName": {
                    "type": "string"
                },
                "topic": {
                    "$ref": "#/definitions/Topic"
                },
                "customerStatus": {
                    "$ref": "#/definitions/CustomerStatus"
                },
                "translation": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/Translation"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "jurisdictionalFilter": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "qualityFilter": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "reverseTheQualityFilter": {
                    "type": "boolean"
                },
                "deidentify": {
                    "type": "boolean"
                },
                "timing": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/Timing"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "description": {
                    "type": "string"
                },
                "transport": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/Transport"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "externalName": {
                    "anyOf": [
                        {
                            "type": "null"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "processingModeFilter": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "routingFilter": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "timeZone": {
                    "type": ["string", "null"]
                },
                "dateTimeFormat": {
                    "type": ["string", "null"]
                },
                "conditionFilter": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "mappedConditionFilter": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/MappedConditionFilter"
                    }
                },
                "enrichmentSchemaNames": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "customerStatus",
                "name",
                "organizationName",
                "topic",
                "translation"
            ],
            "if": {
                "properties": {
                    "topic": { "enum": ["covid-19", "monkeypox", "test"]}
                }
            },
            "then": {
                "allOf": [
                    {"not": { "required": [ "conditionFilter"] }},
                    {"not": { "required": [ "mappedConditionFilter"] }}
                ]
            },
            "message": {
                "required": "Not allowed for some topic",
                "mappedConditionFilter": "Not allowed for non-UP topic"
            },
            "title": "Receiver"
        },
        "MappedConditionFilter": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "type": {
                    "type": "string"
                },
                "value": {
                    "type": "string"
                }
            },
            "required": [
                "type",
                "value"
            ],
            "title": "MappedConditionFilter"
        },
        "Timing": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "operation": {
                    "$ref": "#/definitions/Operation"
                },
                "numberPerDay": {
                    "type": "integer"
                },
                "initialTime": {
                    "$ref": "#/definitions/InitialTime"
                },
                "timeZone": {
                    "type": "string"
                },
                "maxReportCount": {
                    "type": "integer"
                }
            },
            "required": [
                "initialTime",
                "numberPerDay",
                "operation"
            ],
            "title": "Timing"
        },
        "Translation": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "schemaName": {
                    "type": "string"
                },
                "format": {
                    "$ref": "#/definitions/TranslationFormat"
                },
                "defaults": {
                    "$ref": "#/definitions/Defaults"
                },
                "nameFormat": {
                    "type": ["string", "null"]
                },
                "receivingOrganization": {
                    "type": ["string", "null"]
                },
                "type": {
                    "$ref": "#/definitions/TranslationType"
                },
                "useBatchHeaders": {
                    "type": "boolean"
                },
                "useTestProcessingMode": {
                    "type": "boolean"
                },
                "convertPositiveDateTimeOffsetToNegative": {
                    "type": "boolean"
                },
                "useHighPrecisionHeaderDateTimeFormat": {
                    "type": "boolean"
                },
                "useBatching": {
                    "type": "boolean"
                },
                "receivingApplicationName": {
                    "type": ["string", "null"]
                },
                "convertDateTimesToReceiverLocalTime": {
                    "type": "boolean"
                },
                "suppressQstForAoe": {
                    "type": "boolean"
                },
                "receivingApplicationOID": {
                    "type": ["string", "null"]
                },
                "receivingFacilityName": {
                    "type": ["string", "null"]
                },
                "receivingFacilityOID": {
                    "type": ["string", "null"]
                },
                "reportingFacilityName": {
                    "type": ["string", "null"]
                },
                "reportingFacilityId": {
                    "type": ["string", "null"]
                },
                "suppressHl7Fields": {
                    "type": ["string", "null"]
                },
                "useBlankInsteadOfUnknown": {
                    "type": ["string", "null"]
                },
                "replaceValue": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/ReplaceValue"
                        },
                        {
                            "type": "null"
                        }
                    ]
                }
            },
            "required": [
                "type"
            ],
            "title": "Translation"
        },
        "Defaults": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "processing_mode_code": {
                    "type": "string"
                }
            },
            "title": "Defaults"
        },
        "ReplaceValue": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "PID-22-3": {
                    "type": "string"
                }
            },
            "required": [],
            "title": "ReplaceValue"
        },
        "Transport": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "type": {
                    "$ref": "#/definitions/TransportType"
                },
                "host": {
                    "$ref": "#/definitions/Host"
                },
                "port": {
                    "type": ["integer", "string"]
                },
                "filePath": {
                    "$ref": "#/definitions/FilePath"
                },
                "credentialName": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/CredentialName"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "storageName": {
                    "type": "string"
                },
                "containerName": {
                    "type": "string"
                },
                "authTokenUrl": {
                    "type": "string",
                    "format": "uri",
                    "qt-uri-protocols": [
                        "http"
                    ]
                },
                "reportUrl": {
                    "type": "string",
                    "format": "uri",
                    "qt-uri-protocols": [
                        "http"
                    ]
                },
                "headers": {
                    "$ref": "#/definitions/Headers"
                },
                "endpoint": {
                    "type": "string",
                    "format": "uri",
                    "qt-uri-protocols": [
                        "http"
                    ]
                },
                "soapAction": {
                    "type": "string"
                },
                "uuidFormat": {
                    "type": "string"
                },
                "uuidIV": {
                    "type": "integer"
                },
                "apiUrl": {
                    "type": "string"
                }
            },
            "required": [
                "type"
            ],
            "title": "Transport"
        },
        "Headers": {
            "type": "object",
            "additionalProperties": true,
            "title": "Headers"
        },
        "Sender": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
                "name": {
                    "type": "string"
                },
                "organizationName": {
                    "type": "string"
                },
                "topic": {
                    "$ref": "#/definitions/Topic"
                },
                "customerStatus": {
                    "$ref": "#/definitions/CustomerStatus"
                },
                "schemaName": {
                    "type": "string"
                },
                "processingType": {
                    "type": ["string", "null"]
                },
                "senderType": {
                    "type": ["string", "null"]
                },
                "format": {
                    "$ref": "#/definitions/SenderFormat"
                },
                "allowDuplicates": {
                    "type": "boolean"
                }
            },
            "required": [
                "customerStatus",
                "format",
                "name",
                "organizationName",
                "topic"
            ],
            "title": "Sender"
        },
        "Topic": {
            "type": "string",
            "enum": [
                "covid-19",
                "full-elr",
                "etor-ti",
                "elr-elims",
                "monkeypox",
                "testing"
            ],
            "title": "Topic"
        },
        "Jurisdiction": {
            "type": "string",
            "enum": [
                "FEDERAL",
                "STATE",
                "COUNTY"
            ],
            "title": "Jurisdiction"
        },
        "CustomerStatus": {
            "type": "string",
            "enum": [
                "active",
                "inactive",
                "testing"
            ],
            "title": "CustomerStatus"
        },
        "InitialTime": {
            "type": "string",
            "title": "InitialTime"
        },
        "Operation": {
            "type": "string",
            "title": "Operation"
        },
        "TranslationFormat": {
            "type": "string",
            "enum": [
                "CSV",
                "HL7",
                "HL7_BATCH"
            ],
            "title": "TranslationFormat"
        },
        "TranslationType": {
            "type": "string",
            "enum": [
                "CUSTOM",
                "HL7",
                "FHIR",
                "GAEN"
            ],
            "title": "TranslationType"
        },
        "CredentialName": {
            "type": "string",
            "title": "CredentialName"
        },
        "FilePath": {
            "type": "string",
            "title": "FilePath"
        },
        "Host": {
            "type": "string",
            "title": "Host"
        },
        "TransportType": {
            "type": "string",
            "enum": [
                "SFTP",
                "BLOBSTORE",
                "REST",
                "SOAP",
                "GAEN",
                "NULL"
            ],
            "title": "TransportType"
        },
        "SenderFormat": {
            "type": "string",
            "enum": [
                "CSV",
                "HL7",
                "FHIR"
            ],
            "title": "SenderFormat"
        }
    }
}
