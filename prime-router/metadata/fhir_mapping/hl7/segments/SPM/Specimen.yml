resourceType: Specimen
id:
  type: STRING
  valueOf: "GeneralUtils.generateResourceId()"
  expressionType: JEXL

identifier:
  generateList: true
  expressionType: nested
  expressions:
    - condition: $spm21 NOT_NULL
      valueOf: datatypes/EIP/Identifier-PlacerAssignedIdentifier
      generateList: true
      expressionType: resource
      specs: SPM.2
      vars:
        spm21: SPM.2.1
      constants:
        hl7Use: "specimen-id-placer"
        backupExtension: "filler-assigned-identifier"
    - condition: $spm22 NOT_NULL
      valueOf: datatypes/EIP/Identifier-FillerAssignedIdentifier
      generateList: true
      expressionType: resource
      specs: SPM.2
      vars:
        spm22: SPM.2.2
      constants:
        hl7Use: "specimen-id-filler"
        backupExtension: "placer-assigned-identifier"

parent:
  generateList: true
  expressionType: nested
  expressionsMap:
    identifier:
      generateList: true
      expressionType: nested
      expressions:
        - condition: $spm31 NOT_NULL
          valueOf: datatypes/EIP/Identifier-PlacerAssignedIdentifier
          generateList: true
          expressionType: resource
          specs: SPM.3
          vars:
            spm31: SPM.3.1
          constants:
            hl7Use: "specimen-id-placer"
            backupExtension: "filler-assigned-identifier"
        - condition: $spm32 NOT_NULL
          valueOf: datatypes/EIP/Identifier-FillerAssignedIdentifier
          generateList: true
          expressionType: resource
          specs: SPM.3
          vars:
            spm22: SPM.3.2
          constants:
            hl7Use: "specimen-id-filler"
            backupExtension: "placer-assigned-identifier"

type:
  valueOf: datatypes/CWE/CodeableConcept
  expressionType: resource
  specs: SPM.4

container:
  condition: $spm6 NOT_NULL
  expressionType: nested
  generateList: true
  vars:
    spm6: STRING_ALL, SPM.6
  expressionsMap:
    additiveCodeableConcept:
      valueOf: datatypes/CWE/CodeableConcept
      expressionType: resource
      specs: SPM.6 *

collection:
  condition: $spm7 NOT_NULL || $spm8 NOT_NULL || $spm9 NOT_NULL || $spm12 NOT_NULL
  expressionType: nested
  generateList: true
  vars:
    spm7: STRING, SPM.7
    spm8: STRING, SPM.8
    spm9: STRING_ALL, SPM.9
    spm12: STRING, SPM.12
  expressionsMap:
    method:
      valueOf: datatypes/CWE/CodeableConcept
      expressionType: resource
      specs: SPM.7
    bodysite:
      valueOf: datatypes/CWE/CodeableConcept
      expressionType: resource
      specs: SPM.8
    extension:
      condition: $spm9 NOT_NULL
      expressionType: nested
      generateList: true
      specs: SPM.9 *
      expressionsMap:
        url:
          type: SYSTEM_URL
          value: bodySiteModifier
        valueCodeableConcept:
          valueOf: datatypes/CWE/CodeableConcept
          expressionType: resource
    quantity:
      valueOf: datatypes/CQ/Quantity
      expressionType: resource
      specs: SPM.12
    collectedPeriod:
      condition: $end NOT_NULL
      valueOf: datatypes/DR/Period
      expressionType: resource
      specs: SPM.17
      vars:
        start: SPM.17.1
        end: SPM.17.2
        dateTimeIn: SPM.17.1
        dateTimeOut: SPM.17.2
    collectedDateTime:
      condition: $end NULL
      type: STRING
      valueOf: "GeneralUtils.dateTimeWithZoneId(dateTimeIn,ZONEID)"
      expressionType: JEXL
      vars:
        dateTimeIn: SPM.17.1
        end: SPM.17.2
    _collectedDateTime:
      condition: $dateTimeIn NOT_NULL && $end NULL
      expressionType: nested
      vars:
        dateTimeIn: SPM.17.1
        end: SPM.17.2
      expressionsMap:
        extension_1:
          generateList: true
          expressionType: nested
          expressionsMap:
            url:
              type: SYSTEM_URL
              value: hl7v2-date-time
            valueString:
              type: STRING
              valueOf: $dateTimeIn
              expressionType: HL7Spec

note:
  condition: $spm14 NOT_NULL
  expressionType: nested
  generateList: true
  vars:
    spm14: STRING_ALL, SPM.14
  specs: SPM.14 *
  expressionsMap:
    text:
      type: STRING
      valueOf: ST

receivedTime:
  condition: $dateTimeIn NOT_NULL
  type: STRING
  valueOf: "GeneralUtils.dateTimeWithZoneId(dateTimeIn,ZONEID)"
  expressionType: JEXL
  vars:
    dateTimeIn: SPM.18.1
_receivedTime:
  condition: $dateTimeIn NOT_NULL
  expressionType: nested
  vars:
    dateTimeIn: SPM.18.1
  expressionsMap:
    extension_1:
      generateList: true
      expressionType: nested
      expressionsMap:
        url:
          type: SYSTEM_URL
          value: hl7v2-date-time
        valueString:
          type: STRING
          valueOf: $dateTimeIn
          expressionType: HL7Spec