resourceType: Provenance
id:
  type: STRING
  valueOf: "GeneralUtils.generateResourceId()"
  expressionType: JEXL

target:
  valueOf: datatype/Reference
  generateList: true
  expressionType: resource
  specs: $Bundle

entity_1:
  expressionType: nested
  generateList: true
  expressionsMap:
    role:
      type: STRING
      valueOf: "source"

entity_2:
  expressionType: nested
  generateList: true
  vars:
    msh24: STRING_ALL, MSH.24
    msh3: STRING_ALL, MSH.3
  condition: $msh3 NOT_NULL && $msh24 NOT_NULL
  expressionsMap:
    role:
      type: STRING
      valueOf: "source"
    what:
      valueOf: segments/MSH/datatypes/HD/Device
      expressionType: reference
      specs: MSH.3

agent_1:
  expressionType: nested
  generateList: true
  vars:
    msh22: STRING_ALL, MSH.22
    msh4: STRING_ALL, MSH.4
  condition: $msh22 NULL && $msh4 NOT_NULL
  expressionsMap:
    type:
      expressionType: nested
      expressionsMap:
        coding:
          expressionType: nested
          expressionsMap:
            code:
              type: STRING
              valueOf: "author"
            system:
              type: SYSTEM_URL
              valueOf: "http://terminology.hl7.org/CodeSystem/provenance-participant-type"
    who:
      valueOf: datatypes/HD/Organization
      expressionType: reference
      specs: MSH.4

agent_2:
  expressionType: nested
  generateList: true
  vars:
    msh22: STRING_ALL, MSH.22
  condition: $msh22 NOT_NULL
  expressionsMap:
    type:
      expressionType: nested
      expressionsMap:
        coding:
          expressionType: nested
          expressionsMap:
            code:
              type: STRING
              valueOf: "author"
            system:
              type: SYSTEM_URL
              valueOf: "http://terminology.hl7.org/CodeSystem/provenance-participant-type"
    who:
      valueOf: datatypes/XON/Organization
      expressionType: reference
      specs: MSH.22

recorded:
  type: STRING
  valueOf: "GeneralUtils.dateTimeWithZoneId(dateTimeIn,ZONEID)"
  expressionType: JEXL
  vars:
    dateTimeIn: MSH.7

activity:
  expressionType: nested
  constants:
    caret: "^"
  vars:
    msg1: String, MSH.9.1
    msg2: String, MSH.9.2
    msg3: String, MSH.9.3
  expressionsMap:
    coding:
      expressionType: nested
      vars:
        displayValue: $msg1 + $caret + $msg2 + $caret + $msg3
      expressionsMap:
        display:
          type: STRING
          valueOf: $displayValue
