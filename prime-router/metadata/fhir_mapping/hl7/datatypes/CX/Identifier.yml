resourceType: Identifier

value:
  type: STRING
  valueOf: CX.1
  expressionType: HL7Spec

extension_1:
  generateList: true
  expressionType: nested
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: identifier-check-digit
    valueString:
      type: STRING
      expressionType: HL7Spec
      valueOf: CX.2

extension_2:
  generateList: true
  expressionType: nested
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: naming-system-check-digit
    valueString:
      type: STRING
      expressionType: HL7Spec
      valueOf: CX.3

# Checking if HD is an Organization or a System by looking at the ID type.
# If ID type is null or ID type is not ISO or UUID, treat as organization.
# Otherwise, treat as system.
assigner_1:
  vars:
    cx43: String, CX.4.3
  condition: cx43 NULL
  valueOf: datatypes/HD/Organization
  expressionType: reference
  specs: CX.4

assigner_2:
  vars:
    cx43: String, CX.4.3
  condition: $cx43 NOT_NULL && $cx43 NOT_EQUALS ISO && $cx43 NOT_EQUALS UUID
  valueOf: datatypes/HD/Organization
  expressionType: reference
  specs: CX.4

system:
  vars:
    cx41: String, CX.4.1
    cx43: String, CX.4.3
  expressionType: nested
  condition: $cx43 EQUALS ISO || cx43 EQUALS UUID
  expressions:
    - condition: $cx41 NOT_NULL
      expressionType: HL7Spec
      type: STRING
      valueOf: CX.4.1
    - condition: $cx41 NULL && cx43 EQUALS ISO
      expressionType: HL7Spec
      type: STRING
      constants:
        prefix: "urn:oid:"
      vars:
        uri: String, CX.4.2
        join: $prefix + $uri
      valueOf: $join
    - condition: $cx41 NULL && cx43 EQUALS UUID
      expressionType: HL7Spec
      type: STRING
      constants:
        prefix: "urn:uuid:"
      vars:
        uri: String, CX.4.2
        join: $prefix + $uri
      valueOf: $join

extension_system:
  generateList: true
  expressionType: nested
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: coding-system
    valueCodeableConcept:
      valueOf: datatype/CodeableConcept_var
      expressionType: resource
      vars:
        code: String, CX.4

type:
  valueOf: datatype/CodeableConcept_var
  expressionType: resource
  vars:
    code: $code
    system: $system

extension_assigningFacility:
  generateList: true
  expressionType: nested
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: assigning-facility
    valueReference:
      valueOf: datatypes/HD/Organization
      expressionType: reference
      specs: CX.6

period:
  vars:
    startDate: CX.7
    endDate: CX.8
  condition: $startDate NOT_NULL || $endDate NOT_NULL
  expressionType: nested
  expressionsMap:
    start:
      valueOf: "GeneralUtils.dateTimeWithZoneId(startDate,ZONEID)"
      expressionType: JEXL
    _start:
      expressionType: nested
      condition: $startDate NOT_NULL
      expressionsMap:
        extension_1:
          generateList: true
          expressionType: nested
          expressionsMap:
            url:
              type: SYSTEM_URL
              value: hl7v2-date-time
            valueString:
              type: STRING
              valueOf: $startDate
              expressionType: HL7Spec
    end:
      valueOf: "GeneralUtils.dateTimeWithZoneId(endDate,ZONEID)"
      expressionType: JEXL
    _end:
      expressionType: nested
      condition: $endDate NOT_NULL
      expressionsMap:
        extension_1:
          generateList: true
          expressionType: nested
          expressionsMap:
            url:
              type: SYSTEM_URL
              value: hl7v2-date-time
            valueString:
              type: STRING
              valueOf: $endDate
              expressionType: HL7Spec


extension_4:
  generateList: true
  expressionType: nested
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: assigning-jurisdiction
    valueCodeableConcept:
      valueOf: datatypes/CWE/CodeableConcept
      expressionType: resource
      specs: CX.9

extension_5:
  generateList: true
  expressionType: nested
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: assigning-agency-or-department
    valueCodeableConcept:
      valueOf: datatypes/CWE/CodeableConcept
      expressionType: resource
      specs: CX.10

extension_6:
  generateList: true
  expressionType: nested
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: identifier-index-name
    valueString:
      value: $identifierIndexName