resourceType: Patient
# Represents data that needs to be extracted for a Patient Resource in FHIR
# reference: https://www.hl7.org/fhir/patient.html
id:
  type: STRING
  valueOf: "GeneralUtils.generateResourceId()"
  expressionType: JEXL

identifier:
  expressionType: nested
  generateList: true
  expressions:
    - expressionType: resource
      specs: PID.2
      valueOf: datatypes/CX/Identifier
      vars:
        identifierIndexName: "patient-id"
    - expressionType: resource
      specs: PID.3
      valueOf: datatypes/CX/Identifier
      generateList: true
      vars:
        identifierIndexName: "patient-identifier-list"
    - expressionType: resource
      specs: PID.4
      valueOf: datatypes/CX/Identifier
      vars:
        identifierIndexName: "alternate-patient-id"

name:
  expressionType: resource
  specs: PID.5
  valueOf: datatypes/XPN/HumanName

birthDate:
  expressionType: nested
  expressions:
    - type: DATE
      valueOf: PID.7
      expressionType: HL7Spec
    - condition: $pid7 NOT_NULL
      vars:
        pid7: PID.7
        dateTimeIn: PID.7, GeneralUtils.dateTimeWithZoneId(dateTimeIn,ZONEID)
        isTime: PID.7, GeneralUtils.dateTimeWithZoneId(isTime,ZONEID).length() > 10
      expressionType: nested
      expressionsMap:
        # this extension is needed to comply with the official HL7v2-to-FHIR mapping
        extension_1:
          condition: $dateTimeIn NOT_NULL && $isTime EQUALS "true"
          generateList: true
          expressionType: nested
          expressionsMap:
            url:
              type: SYSTEM_URL
              value: birthTime
            valueDateTime:
              valueOf: $dateTimeIn
              expressionType: HL7Spec
        # this extension is needed to reliably translate back to HL7 from FHIR
        extension_2:
          generateList: true
          expressionType: nested
          expressionsMap:
            url:
              type: SYSTEM_URL
              value: hl7v2-date-time
            valueString:
              type: STRING
              valueOf: $pid7
              expressionType: HL7Spec

extension:
  expressionType: nested
  expressions:
    - expressionType: nested
      expressionMap:
        url:
          type: SYSTEM_URL
          value: mothersMaidenName
        valueString:
      valueHumanName:
        valueOf: datatypes/XPN/HumanName
        expressionType: resource
        condition: $pid6 NOT_NULL
        specs: PID.6
        vars:
          pid6: PID.6