resourceType: Specimen
id:
  type: STRING
  valueOf: "GeneralUtils.generateResourceId()"
  expressionType: JEXL

identifier_1:
  condition: $spm21 NOT_NULL
  valueOf: datatypes/EIP/Identifier-PlacerAssignedIdentifier
  generateList: true
  expressionType: resource
  specs: SPM.2
  vars:
    spm21: SPM.2.1
  constants:
    hl7Use: "specimen-id-placer"
    backupExtension: "filler-assigned-identifier"

identifier_2:
  condition: $spm22 NOT_NULL
  valueOf: datatypes/EIP/Identifier-FillerAssignedIdentifier
  generateList: true
  expressionType: resource
  specs: SPM.2
  vars:
    spm22: SPM.2.2
  constants:
    hl7Use: "specimen-id-filler"
    backupExtension: "placer-assigned-identifier"

status:
  type: SPECIMEN_STATUS
  valueOf: SPM.20
  expressionType: HL7Spec

type:
  valueOf: datatype/CodeableConcept
  expressionType: resource
  specs: SPM.4 | SPM.5 | OBR.15.1

receivedTime:
  type: STRING
  valueOf: "GeneralUtils.dateTimeWithZoneId(dateTimeIn,ZONEID)"
  expressionType: JEXL
  vars:
    dateTimeIn: SPM.18 | OBR.14
_receivedTime:
  expressionType: nested
  condition: $dateTimeIn NOT_NULL
  vars:
    dateTimeIn: SPM.18 | OBR.14
  expressionsMap:
    extension_1:
      generateList: true
      expressionType: nested
      expressionsMap:
        url:
          type: SYSTEM_URL
          value: hl7v2-date-time
        valueString:
          type: STRING
          valueOf: $dateTimeIn
          expressionType: HL7Spec

collection:
  valueOf: secondary/Collection
  expressionType: resource

processing:
  condition: $spm6 NOT_NULL
  valueOf: secondary/processing
  expressionType: resource
  vars:
    spm6: SPM.6

condition:
  condition: $spm24 NOT_NULL
  valueOf: datatype/CodeableConcept
  expressionType: resource
  specs: SPM.24
  vars:
    spm24: SPM.24

container:
  condition: $containerTypeCWE NOT_NULL || $specimenAdditive NOT_NULL
  valueOf: secondary/Container
  expressionType: resource
  generateList: true
  vars:
    containerTypeCWE: SPM.27
    specimenQuantity: SPM.26
    specimenAdditive: SPM.6

subject:
  valueOf: datatype/Reference
  expressionType: resource
  specs: $Patient

extension_1:
  condition: $value NOT_NULL
  generateList: true
  valueOf: extension/Extension
  expressionType: resource
  vars:
    value: String, OBR.15.1
  constants:
    KEY_NAME_SUFFIX: String
    urlValue: specimen-name-or-code

extension_2:
  condition: $value NOT_NULL
  generateList: true
  valueOf: extension/Extension
  expressionType: resource
  vars:
    value: String, OBR.15.2
  constants:
    KEY_NAME_SUFFIX: String
    urlValue: specimen-source-additives

extension_3:
  condition: $value NOT_NULL
  generateList: true
  valueOf: extension/Extension
  expressionType: resource
  vars:
    value: String, OBR.15.3
  constants:
    KEY_NAME_SUFFIX: String
    urlValue: specimen-collection-method


extension_4-specimenTypeModifier:
  condition: $spm5 NOT_NULL && $spm4 NOT_NULL
  generateList: true
  expressionType: nested
  vars:
    spm5: SPM.5
    spm4: SPM.4
  expressionsMap:
    url:
      type: SYSTEM_URL
      value: specimen-type-modifier
    valueCodeableConcept:
      valueOf: datatype/CodeableConcept
      expressionType: resource
      specs: SPM.5

note_1:
  valueOf: datatype/Annotation_var
  expressionType: resource
  generateList: true
  vars:
    noteText: SPM.14

note_2:
  condition: collectorsComment NOT_NULL
  valueOf: datatypes/CWE/Annotation
  expressionType: resource
  generateList: true
  specs: OBR.39
  vars:
    collectorsComment: String, OBR.39
  constants:
    hl7v2Name: collectors-comment