constants:
  hl7OBXField: '%{hl7SegmentGroup}/OBX'
elements:
  - name: result-set-id
    value: [ '%resultIndex + 1' ]
    hl7Spec: [ '%{hl7OBXField}-1' ]

  - name: observation-identifier-code
    resource: '%resource.code'
    constants:
      cweFieldPath: '%{hl7OBXField}-3'
    schema: ../../common/datatype/ce-coded-with-exceptions

  - name: observation-result-status
    value: [ '%resource.status' ]
    condition: '%resource.dataAbsentReason.exists().not() or %resource.dataAbsentReason.coding.where(extension(%`rsext-code-index-name`).value = "identifier").code = "unknown"'
    hl7Spec: [ '%{hl7OBXField}-11' ]
    valueSet:
      values:
        registered: I
        preliminary: P
        final: F
        corrected: C
        amended: C
        entered-in-error: W

  - name: observation-result-status-cancelled
    value: [ "'X'" ]
    condition: '%resource.dataAbsentReason.coding.where(extension(%`rsext-code-index-name`).value = "identifier").exists() and %resource.dataAbsentReason.coding.where(extension(%`rsext-code-index-name`).value = "identifier").code = "cannot-be-obtained"'
    hl7Spec: [ '%{hl7OBXField}-11' ]

  - name: observation-result-status-not-asked
    value: [ "'N'" ]
    condition: '%resource.dataAbsentReason.coding.where(extension(%`rsext-code-index-name`).value = "alternate identifier").exists() and %resource.dataAbsentReason.coding.where(extension(%`rsext-code-index-name`).value = "alternate identifier").code = "not-asked"'
    hl7Spec: [ '%{hl7OBXField}-11' ]