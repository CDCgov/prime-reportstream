elements:

  # This mapping relies on the inventory https://docs.google.com/spreadsheets/d/1zLANrSl_qRMGtJED5BnklU9EipB4xeU4rgmtr03hbIA/edit#gid=0
  # where the first identifier contains the namespace id and the second identifier contains the universal ID
  - name: namespace-id
    resource: '%resource.identifier.where(type.exists().not())[0]'
    value: [ '%resource.value' ]
    hl7Spec: [ '%{hl7HDField}-1' ]

  - name: universal-id
    condition: '%resource.exists()'
    resource: '%resource.identifier.where(type.coding.system = "http://terminology.hl7.org/CodeSystem/v2-0301").first()'
    value: [ '%resource.value' ]
    hl7Spec: [ '%{hl7HDField}-2' ]

  - name: universal-id
    condition: >
      %resource.identifier.where(type.coding.system = "http://terminology.hl7.org/CodeSystem/v2-0301").exists().not() and
      %resource.identifier[1].exists()
    value: [ '%resource.identifier[1].value' ]
    hl7Spec: [ '%{hl7HDField}-2' ]

  - name: universal-id-type
    resource: '%resource.identifier.where(type.coding.system = "http://terminology.hl7.org/CodeSystem/v2-0301").first()'
    value: [ '%resource.type.coding[0].code' ]
    hl7Spec: [ '%{hl7HDField}-3' ]
