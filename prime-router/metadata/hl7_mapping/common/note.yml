elements:
  - name: note-id
    value: [ '%noteIndex + 1' ]
    hl7Spec: [ '%{hl7NotePath}/NTE(%{noteIndex})-1' ]

  - name: note-source
    value:
      - '%noteDetails.extension(%`rsext-note-source`).value.coding.code'
    hl7Spec: [ '%{hl7NotePath}/NTE(%{noteIndex})-2' ]

  - name: note-comment
    condition: '%noteDetails.author.exists().not() or (%noteDetails.author.exists() and %noteDetails.author.is(string).not())'
    value: [ '%resource' ]
    hl7Spec: [ '%{hl7NotePath}/NTE(%{noteIndex})-3' ]

  - name: note-comment-author-string
    condition: '%noteDetails.author.exists() and %noteDetails.author.is(string)'
    value: [ '%resource + " Authored by: " + %noteDetails.author' ]
    hl7Spec: [ '%{hl7NotePath}/NTE(%{noteIndex})-3' ]

  - name: note-comment-type-identifier
    resource: '%noteDetails.extension(%`rsext-note-type`).value'
    constants:
      cweFieldPath: '%{hl7NotePath}/NTE(%{noteIndex})-4'
    schema: datatype/ce-coded-with-exceptions

  - name: note-author
    condition: '%noteDetails.author.exists() and %noteDetails.author.is(Reference)'
    resource: '%noteDetails.author.resolve()'
    schema: datatype/xcn-contact
    constants:
      hl7XCNField: '%{hl7NotePath}/NTE(%{noteIndex})-5'
      contactIndex: '0'

