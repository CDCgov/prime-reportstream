elements:

  - name: obx-value-st
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "ST"'
    value: [ '%resource.value' ]
    hl7Spec: [ '%{hl7OBXField}-5' ]

  - name: obx-value-vr-1
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "VR"'
    value: [ '%resource.value.split("-").first()' ]
    hl7Spec: [ '%{hl7OBXField}-5-1' ]

  - name: obx-value-vr-2
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "VR"'
    value: [ '%resource.value.split("-").last()' ]
    hl7Spec: [ '%{hl7OBXField}-5-2' ]

  - name: obx-value-sn-string-1
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(string) and %resource.value.contains("+")'
    value: [ '%resource.value.split("+")[0]' ]
    hl7Spec: [ '%{hl7OBXField}-5-1' ]

  - name: obx-value-sn-string-2
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(string) and %resource.value.contains("+")'
    value: [ '%resource.value.split("+")[1]' ]
    hl7Spec: [ '%{hl7OBXField}-5-2' ]

  - name: obx-value-sn-string-3
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(string) and %resource.value.contains("+")'
    value: [ '%resource.value.split("+")[2]' ]
    hl7Spec: [ '%{hl7OBXField}-5-3' ]

  - name: obx-value-sn-string-4
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(string) and %resource.value.contains("+")'
    value: [ '%resource.value.split("+")[3]' ]
    hl7Spec: [ '%{hl7OBXField}-5-4' ]

  - name: obx-value-sn-string-no-structure
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(string) and %resource.value.contains("+").not()'
    value: [ '%resource.value' ]
    hl7Spec: [ '%{hl7OBXField}-5-2' ]

  - name: obx-value-cne
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "CNE"'
    schema: ../../datatypes/codeableConcept/CNE
    resource: '%resource.value'
    constants:
      cneFieldPath: '%{hl7OBXField}-5'

  - name: obx-value-cwe
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "CWE"'
    schema: ../../datatypes/codeableConcept/CWE
    resource: '%resource.value'
    constants:
      cweFieldPath: '%{hl7OBXField}-5'

  - name: obx-value-is
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "IS"'
    value: [ '%resource.coding.code' ]
    hl7Spec: [ '%{hl7OBXField}-5' ]

  - name: obx-value-dr
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "DR"'
    schema: ../Patient/Dr # TODO this should be moved
    constants:
      hl7DRField: '%{hl7OBXField}-5'

  - name: obx-value-dtm-dt
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "DTM" or %context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "DT"'
    value: [ '%resource.value.extension(%`rsext-hl7v2-date-time`).value' ]
    hl7Spec: [ '%{hl7OBXField}-5' ]

  - name: obx-value-tm
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "TM"'
    value: [ '%resource.value' ]
    hl7Spec: [ '%{hl7OBXField}-5' ]

  - name: obx-value-nr
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "NR"'
    schema: ../../datatypes/Range/NR
    resource: '%resource.value'
    constants:
      hl7NRField: '%{hl7OBXField}-5'

  - name: obx-value-sn-range
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(Range)'
    schema: ../../datatypes/Range/SN
    resource: '%resource.value'
    constants:
      hl7SNField: '%{hl7OBXField}-5'

  - name: obx-value-sn-ratio
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(Ratio)'
    schema: ../../datatypes/Ratio/SN
    resource: '%resource.value'
    constants:
      hl7SNField: '%{hl7OBXField}-5'

  - name: obx-value-nm
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "NM"'
    value: [ '%resource.value.value' ]
    hl7Spec: [ '%{hl7OBXField}-5' ]

  - name: obx-value-sn-quantity
    condition: '%context.extension(%`rsext-obx-observation`).extension.where(url = "obx-2-value-type").value = "SN" and %resource.value.is(Quantity)'
    schema: ../../datatypes/Quantity/SN
    resource: '%resoure.value'
    constants:
      hl7SNField: '%{hl7OBXField}-5'



