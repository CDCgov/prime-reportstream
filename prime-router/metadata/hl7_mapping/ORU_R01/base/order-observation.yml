name: ORU-R01-order-observation
constants:
  hl7Order: /PATIENT_RESULT/ORDER_OBSERVATION(%{orderIndex})
elements:
  - name: order-segment
    # Only create the segment if we have data for it
    condition: '%resource.basedOn.resolve().extension(%`rsext-order-control`).exists()'
    schema: order

  - name: observation-request
    # Condition from ORU_RO1 covers this schema as well
    schema: observation-request

  - name: specimen
    resource: '%resource.specimen.resolve()'
    condition: '%resource.exists()'
    schema: specimen

  - name: timing-segment
    resource: '%resource.basedOn.resolve()'
    # Only create the segment if we have data for it
    condition: >
      %resource.extension(%`rsext-start-of-service`).exists() or
      %resource.extension(%`rsext-end-of-service`).exists() or
      %resource.extension(%`rsext-service-priority`).exists()
    schema: timing-quantity
