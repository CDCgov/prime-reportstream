name: ORU-R01-xcn-contact
constants:
  hl7XCNFieldPath: /PATIENT_RESULT/PATIENT/VISIT/(%{hl7XCNField})(%{orderIndex})
# Practitioner to XCN mapping
elements:
  - name: xcn-id-number
    value: [ '%resource.identifier.value' ]
    hl7Spec: [ '%{hl7XCNFieldPath}-1' ]

  - name: xcn-family-name
    value: [ '%resource.name.family' ]
    hl7Spec: [ '%{hl7XCNFieldPath}-2' ]

  - name: xcn-given-name
    value: [ '%resource.name.given[0]' ]
    hl7Spec: [ '%{hl7XCNFieldPath}-3' ]

  - name: xcn-other-given-names
    value: [ '%resource.name.given.tail()' ]
    hl7Spec: [ '%{hl7XCNFieldPath}-4' ]

  - name: xcn-suffix
    value: [ '%resource.name.suffix' ]
    hl7Spec: [ '%{hl7XCNFieldPath}-7' ]

  - name: xcn-assigning-authority
    condition: '%resource.extension(%`rsext-authority-facility`).exists()'
    resource: '%resource.identifier'
    constants:
      hl7HDField: '%{hl7XCNFieldPath}-9'
      # cannot use %`rext due to mix of constant and fhirpath substitution syntax
      namespaceExtName: 'https://reportstream.cdc.gov/fhir/StructureDefinition/assigning-authority-namespace-id'
      universalIdExtName: 'https://reportstream.cdc.gov/fhir/StructureDefinition/assigning-authority-universal-id'
    schema: hd-hierarchic-designator

  - name: xcn-name-type-code
    condition: '%resource.name.use = ''official'''
    value: [ '''L''']
    hl7Spec: [ '%{xcnFieldPath}(%{contactIndex})-10' ]

  - name: xcn-type
    value: [ '%resource.identifier.type.coding.code' ]
    hl7Spec: [ '%{hl7XCNFieldPath}-13' ]

  - name: xcn-assigning-facility
    condition: '%resource.extension(%`rsext-assigning-facility`).exists()'
    resource: '%resource.identifier'
    constants:
      hl7HDField: '%{hl7XCNFieldPath}-14'
      # cannot use %`rext due to mix of constant and fhirpath substitution syntax
      namespaceExtName: 'https://reportstream.cdc.gov/fhir/StructureDefinition/assigning-facility-namespace-id'
      universalIdExtName: 'https://reportstream.cdc.gov/fhir/StructureDefinition/assigning-facility-universal-id'
    schema: hd-hierarchic-designator