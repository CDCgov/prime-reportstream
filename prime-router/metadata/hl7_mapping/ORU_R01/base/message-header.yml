name: ORU-R01-message-header
elements:
  - name: sending-application-namespace-id
    resource: '%resource.source.extension(%`rsext-source-software-vendor-org`).value.resolve()'
    value: [ '%resource.extension(%`rsext-assigning-authority-namespace-id`).value' ]
    hl7Spec: [ MSH-3-1 ]

  - name: sending-application-universal-id
    condition: '%resource.source.extension(%`rsext-source-identifier-system`).value is Oid'
    value: [ '%resource.source.extension(%`rsext-source-identifier-system`).value.toString().replace(''urn:oid:'','''')' ]
    hl7Spec: [ MSH-3-2 ]

  - name: sending-application-universal-id-type
    value: [ '''ISO''' ]
    hl7Spec: [ MSH-3-3 ]

  - name: sending-facility_namespace-id
    value: [ '%resource.sender.resolve().name' ]
    hl7Spec: [ MSH-4-1 ]

  - name: sending-facility-universal-id
    condition: '%resource.sender.resolve().identifier[0].value.startsWith(''urn:oid:'')'
    value: [ '%resource.sender.resolve().identifier[0].value.toString().replace(''urn:oid:'','''')' ]
    hl7Spec: [ MSH-4-2 ]

  - name: sending-facility-universal-id-type
    value: [ '''ISO''' ]
    hl7Spec: [ MSH-4-3 ]

  - name: receiving-application-namespace-id
    value: [ '%resource.destination.name' ]
    hl7Spec: [ MSH-5-1 ]

  - name: receiving-application-universal-id
    condition: '%resource.destination.extension(%`rsext-receiving-application-identifier`).value is Oid'
    value: [ '%resource.destination.extension(%`rsext-receiving-application-identifier`).value.toString().replace(''urn:oid:'','''')' ]
    hl7Spec: [ MSH-5-2 ]

  - name: receiving-application-universal-id-type
    value: [ '''ISO''' ]
    hl7Spec: [ MSH-5-3]

  - name: receiving-facility-namespace-id
    value: [ '%resource.destination.endpoint' ]
    hl7Spec: [ MSH-6-1 ]

  - name: receiving-facility-universal-id
    condition: '%resource.destination.extension(%`rsext-receiving-facility-identifier`).value is Oid'
    value: [ '%resource.destination.extension(%`rsext-receiving-facility-identifier`).value.toString().replace(''urn:oid:'','''')' ]
    hl7Spec: [ MSH-6-2 ]

  - name: receiving-facility-universal-id-type
    value: [ '''ISO''' ]
    hl7Spec: [ MSH-6-3 ]

  - name: message-date-time
    value: [ 'Bundle.timestamp' ]
    required: true
    hl7Spec: [ MSH-7 ]

  - name: security
    value: [ 'Bundle.meta.security.code' ]
    hl7Spec: [ MSH-8-1 ]

  - name: message-control-id
    value: [ 'Bundle.identifier.value' ]
    required: true
    hl7Spec: [ MSH-10 ]

  - name: processing-id
    resource: '%resource.meta.extension(%`rsext-source-processing-id`).value'
    value: [ '%resource.coding.code' ]
    hl7Spec: [ MSH-11-1 ]

  - name: country-code
    value: [ '%resource.sender.resolve().address.country' ]
    hl7Spec: [ MSH-17 ]