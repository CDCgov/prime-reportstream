hl7Type: ORU_R01
hl7Version: 2.5.1
constants:
  # Prefix for RS custom extension URLs
  rsext: '"https://reportstream.cdc.gov/fhir/StructureDefinition/"'
elements:
  - condition: >
      Bundle.entry.resource.ofType(MessageHeader).exists() and
      Bundle.entry.resource.ofType(Provenance).exists() and
      Bundle.entry.resource.ofType(Provenance).activity.coding.code = 'R01'
    resource: 'Bundle.entry.resource.ofType(MessageHeader)'
    required: true
    schema: base/message-header

  - condition: 'Bundle.entry.resource.ofType(MessageHeader).exists()'
    resource: 'Bundle.entry.resource.ofType(MessageHeader)'
    schema: base/software

  - resource: 'Bundle.entry.resource.ofType(Patient)'
    condition: '%resource.count() = 1'
    required: true
    schema: base/patient

  - resource: 'Bundle.entry.resource.ofType(Patient).contact'
    condition: '%resource.exists()'
    schema: base/patient-contact

  - resource: 'Bundle.entry.resource.ofType(Encounter)'
    condition: '%resource.count() = 1'
    schema: base/patient-visit

  - resource: 'Bundle.entry.resource.ofType(DiagnosticReport)'
    condition: '%resource.count() > 0'
    required: true
    schema: base/order-observation
    resourceIndex: orderIndex