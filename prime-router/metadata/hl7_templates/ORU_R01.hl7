{%- for messageHeader in bundle|path("Bundle.entry.resource.as(MessageHeader)") -%}
MSH|^~\&|{{ messageHeader.source.name }},||||20220228113310.143-0500||ORU^R01^ORU_R01|301|P|2.5.1
{% end %}
{%- for patient in bundle|path("Bundle.entry.resource.as(Patient)") -%}
PID|{{ loop.index + 1 }}||{{ patient.identifier[0].value }}
{%- end %}
OBR|
{%- for observation in bundle|path("Bundle.entry.resource.as(Observation)") %}
OBX|{{ loop.index + 1 }}|CWE|{{observation.code.coding[0].code}}^{{observation.code.text}}^LN
{%- end %}