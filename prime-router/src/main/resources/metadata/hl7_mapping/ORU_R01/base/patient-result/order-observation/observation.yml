# $schema: ./../../../../../../../../../metadata/json_schema/fhir/fhir-to-hl7-mapping.json

elements:

  # Grab only the AOE observations from ServiceRequest.supportingInfo NOT associated with a specimen
  - name: observation-result-with-aoe
    resource: '%resource.result.resolve() | %resource.basedOn.resolve().supportingInfo.resolve()'
    schema: classpath:/metadata/hl7_mapping/resources/Observation/OBX.yml
    resourceIndex: resultIndex
    constants:
      hl7OBXField: '/PATIENT_RESULT(%{patientIndex})/ORDER_OBSERVATION(%{orderIndex})/OBSERVATION(%{resultIndex})/OBX'
      hl7ObservationPath: '/PATIENT_RESULT(%{patientIndex})/ORDER_OBSERVATION(%{orderIndex})/OBSERVATION'

  - name: order-note
    resource: '%resource.basedOn.resolve().note.where(text.exists())'
    schema: classpath:/metadata/hl7_mapping/ORU_R01/base/patient-result/order-observation/order-note.yml
    resourceIndex: noteIndex