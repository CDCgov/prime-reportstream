constants:
  hl7NK1FieldPath: '%{hl7SegmentGroup}/NK1(%{relatedPersonIndex})'

elements:
  - name: set-id
    value: [ 'relatedPersonIndex + 1' ]
    hl7Spec: [ '%{hl7NK1FieldPath}-1' ]

  - name: name
    resource: '%resource.name.where(extension(%`rsext-hl7v2Field`).value = "NK1.2")'
    resourceIndex: xpnIndex
    constants:
      xpnField: '%{hl7NK1FieldPath}-2(%{xpnIndex})'
    schema: classpath:/metadata/hl7_mapping/v251-elr/datatypes/HumanName/XPN_ELR.yml

  - name: relationship
    resource: '%resource.relationship.where(extension(%`rsext-hl7v2Field`).value = "NK1.3")'
    constants:
      cweField: '%{hl7NK1FieldPath}-3'
    schema: classpath:/metadata/hl7_mapping/v251-elr/datatypes/codeableConcept/CWE_ELR.yml

  - name: address
    resource: '%resource.address.where(extension(%`rsext-hl7v2Field`).value = "NK1.4")'
    resourceIndex: xadIndex
    constants:
      xadField: '%{hl7NK1FieldPath}-4(%{xadIndex})'
    schema: classpath:/metadata/hl7_mapping/v251/datatypes/Address/XAD.yml

  - name: phone-number
    resource: '%resource.telecom.where(extension(%`rsext-hl7v2Field`).value = "NK1.5")'
    schema: classpath:/metadata/hl7_mapping/v251/datatypes/contactPoint/XTN.yml
    constants:
      hl7TelecomField: '%{hl7NK1FieldPath}-5'
    resourceIndex: telecomIndex

  #  NK1.6 deprecated in NIST
  - name: business-phone-number
    condition: false

  #  NK1.7 deprecated in NIST
  - name: contact-role
    condition: false

  #  NK1.8 deprecated in NIST
  - name: start-date
    condition: false

  #  NK1.9 deprecated in NIST
  - name: end-date
    condition: false

  #  NK1.12 deprecated in NIST
  - name: next-of-kin-employee-number
    condition: false

  #  NK1.15 deprecated in NIST
  - name: administrative-sex
    condition: false

  - name: primary-language
    resource: '%resource.communication.language'
    constants:
      cweField: '%{hl7NK1FieldPath}-20'
    schema: classpath:/metadata/hl7_mapping/v251/datatypes/codeableConcept/CWE.yml

  - name: contact-person-name
    resource: '%resource.name.where(extension(%`rsext-hl7v2Field`).value = "NK1.30")'
    resourceIndex: xpnIndex
    constants:
      xpnField: '%{hl7NK1FieldPath}-30(%{xpnIndex})'
    schema: classpath:/metadata/hl7_mapping/v251-elr/datatypes/HumanName/XPN_ELR.yml

  - name: contact-person-phone-number
    resource: '%resource.telecom.where(extension(%`rsext-hl7v2Field`).value = "NK1.31")'
    schema: classpath:/metadata/hl7_mapping/v251/datatypes/contactPoint/XTN.yml
    constants:
      hl7TelecomField: '%{hl7NK1FieldPath}-31'
    resourceIndex: telecomIndex

  - name: contact-person-address
    resource: '%resource.address.where(extension(%`rsext-hl7v2Field`).value = "NK1.32")'
    resourceIndex: xadIndex
    constants:
      xadField: '%{hl7NK1FieldPath}-32(%{xadIndex})'
    schema: classpath:/metadata/hl7_mapping/v251/datatypes/Address/XAD.yml

  #  NK1.33 deprecated in NIST
  - name: next-of-kin-identifier
    condition: false

  #  NK1.37 deprecated in NIST
  - name: contact-person-ssn
    condition: false

  #  NK1.40 deprecated in NIST
  - name: next-of-kin-telecomm-info
    condition: false

  #  NK1.41 deprecated in NIST
  - name: contact-person-telecomm-info
    condition: false

  - name: nk1-extension-values
    resource: '%resource.extension(%`rsext-nk1-related-person`)'
    schema: classpath:/metadata/hl7_mapping/resources/RelatedPerson/NK1Extension.yml