elements:

  - name: placer-order-number-from-extension
    condition: '%context.identifier.where(extension(%`rsext-hl7v2Field`).value = "OBR.2").exists().not()'
    resource: '%resource.extension.where(url = "obr-2-placer-order-number").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/identifier-extension/EI.yml
    constants:
      eiFieldPath: '%{obrFieldPath}-2'

  - name: filler-order-number-from-extension
    condition: '%context.identifier.where(extension(%`rsext-hl7v2Field`).value = "OBR.3").exists().not()'
    resource: '%resource.extension.where(url = "obr-3-filler-order-number").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/identifier-extension/EI.yml
    constants:
      eiFieldPath: '%{obrFieldPath}-3'


  - name: collector-identifier
    resource: '%resource.extension.where(url = "obr-10-collector-identifier").value.resolve()'
    schema: classpath:/metadata/hl7_mapping/resources/Practitioner/XCN.yml
    constants:
      hl7XCNField: '%{obrFieldPath}-10(%{xcnIndex})'
    resourceIndex: xcnIndex

  - name: specimen-action-code
    value: [ '%resource.extension.where(url = "obr-11-specimen-action-code").value' ]
    hl7Spec: [ '%{obrFieldPath}-11' ]

  - name: collector-identifier
    resource: '%resource.extension.where(url = "obr-12-danger-code").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/codeableConcept/CWE.yml
    constants:
      cweField: '%{obrFieldPath}-12'

  - name: clinical-information
    value: [ '%resource.extension.where(url = "obr-13-clinical-information").value' ]
    hl7Spec: [ '%{obrFieldPath}-13' ]

  - name: call-back-phone-number-obr-from-extension
    condition: '%context.requester.where(extension(%`rsext-callback-number`).value.extension(%`rsext-hl7v2Field`).value[%telecomIndex] = "OBR.17").exists().not()'
    resource: '%resource.extension.where(url = "https://reportstream.cdc.gov/fhir/StructureDefinition/callback-number").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/contactPoint/XTN.yml
    resourceIndex: telecomIndex
    constants:
      hl7TelecomField: '%{obrFieldPath}-17'

  - name: placer-field-1
    value: [ '%resource.extension.where(url = "obr-18-placer-field-1").value' ]
    hl7Spec: [ '%{obrFieldPath}-18' ]

  - name: placer-field-2
    value: [ '%resource.extension.where(url = "obr-19-placer-field-2").value' ]
    hl7Spec: [ '%{obrFieldPath}-19' ]

  - name: filler-field-1
    value: [ '%resource.extension.where(url = "obr-20-filler-field-1").value' ]
    hl7Spec: [ '%{obrFieldPath}-20' ]

  - name: filler-field-2
    value: [ '%resource.extension.where(url = "obr-21-filler-field-2").value' ]
    hl7Spec: [ '%{obrFieldPath}-21' ]

  - name: charge-to-practice
    resource: '%resource.extension.where(url = "obr-23-charge-to-practice")'
    schema: classpath:/metadata/hl7_mapping/datatypes/extensionMOC/MOC.yml
    constants:
      hl7MOCField: '%{obrFieldPath}-23'

  - name: diagnostic-serv-sect-id
    value: [ '%resource.extension.where(url = "obr-24-diagnostic-serv-sect-id").value' ]
    hl7Spec: [ '%{obrFieldPath}-24' ]

  - name: parent-result
    resource: '%resource.extension.where(url = "obr-26-parent-result")'
    schema: classpath:/metadata/hl7_mapping/datatypes/extensionPRL/PRL.yml
    constants:
      hl7PRLField: '%{obrFieldPath}-26'

  - name: result-copies-to
    resource: '%resource.extension.where(url = "obr-28-result-copies-to").value.resolve()'
    schema: classpath:/metadata/hl7_mapping/resources/Practitioner/XCN.yml
    constants:
      hl7XCNField: '%{obrFieldPath}-28(%{xcnIndex})'
    resourceIndex: xcnIndex

  - name: parent-order
    resource: '%resource.extension.where(url = "obr-29-parent-order").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/identifier-placerAssignedIdentifier/EIP.yml
    constants:
      eipFieldPath: '%{obrFieldPath}-29'

  - name: result-interpreter
    resource: '%resource.extension.where(url = "obr-33-assistant-result-interpreter").value.resolve()'
    constants:
      hl7NDLField: '%{obrFieldPath}-33(%{ndlIndex})'
    resourceIndex: ndlIndex
    schema: classpath:/metadata/hl7_mapping/resources/PractitionerRole/NDL.yml

  - name: scheduled-datetime
    value: [ '%resource.extension.where(url = "obr-36-scheduled-datetime").value' ]
    hl7Spec: [ '%{obrFieldPath}-36' ]

  - name: collectors-comment
    resource: '%resource.extension.where(url = "obr-39-collectors-comment").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/codeableConcept/CWE.yml
    resourceIndex: cweIndex
    constants:
      cweField: '%{obrFieldPath}-39(%{cweIndex})'

  - name: procedure-code
    resource: '%resource.extension.where(url = "obr-44-procedure-code").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/codeableConcept/CNE.yml
    constants:
      cneFieldPath: '%{obrFieldPath}-44'

  - name: procedure-code-modifier
    resource: '%resource.extension.where(url = "obr-45-procedure-code-modifier").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/codeableConcept/CNE.yml
    constants:
      cneFieldPath: '%{obrFieldPath}-45(%{cweIndex})'
    resourceIndex: cweIndex


  - name: medically-necessary-duplicate-procedure
    resource: '%resource.extension.where(url = "obr-48-medically-necessary-duplicate-procedure").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/codeableConcept/CWE.yml
    resourceIndex: cweIndex
    constants:
      cweField: '%{obrFieldPath}-48(%{cweIndex})'

  - name: result-handling
    value: [ '%resource.extension.where(url = "obr-49-result-handling").value' ]
    hl7Spec: [ '%{obrFieldPath}-49' ]

  - name: parent-universal-service-identifier
    resource: '%resource.extension.where(url = "obr-50-parent-universal-service-identifier").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/codeableConcept/CWE.yml
    resourceIndex: cweIndex
    constants:
      cweField: '%{obrFieldPath}-50(%{cweIndex})'

  - name: alternate-placer-order-number-from-identifier
    resource: '%resource.extension.where(url = "obr-53-alternate-placer-order-number").value'
    schema: classpath:/metadata/hl7_mapping/datatypes/identifier/CX.yml
    constants:
      cxField: '%{obrFieldPath}-53(%{cxIndex})'
    resourceIndex: cxIndex