# $schema: ./../../../../../../../../../metadata/json_schema/fhir/fhir-to-hl7-mapping.json

constants:
  observationPath: '%resource.supportingInfo.resolve().ofType(Observation).where(subject.resolve().id = %resource.subject.resolve().id)'

elements:

  - name: observation-result
    resource: '%observationPath'
    resourceIndex: resultIndex
    required: false
    schema: classpath:/metadata/hl7_mapping/resources/Observation/OBX.yml
    constants:
      hl7OBXField: '/ORDER(%{orderIndex})/OBSERVATION_REQUEST/OBSERVATION(%{resultIndex})/OBX'
      hl7ObservationPath: '/ORDER(%{orderIndex})/OBSERVATION_REQUEST/OBSERVATION(%{resultIndex})'

# todo
#  - name: observation-participation-information
#    resource: '%observationPath.device.resolve().where(udiCarrier.exists())'
#    schema: classpath:/metadata/hl7_mapping/resources/Device/PRT.yml
#    constants:
#      hl7SegmentGroup: '/ORDER(%{orderIndex})/OBSERVATION_REQUEST/OBSERVATION(%{resultIndex})'