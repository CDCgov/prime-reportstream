# $schema: ../../../../../../metadata/json_schema/fhir/fhir-to-fhir-transform.json
elements:
  - name: observation-loinc-device-version-id
    resource: '%resource.code.coding.where(extension("https://reportstream.cdc.gov/fhir/StructureDefinition/cwe-coding").value = "coding")'
    condition: '%resource.version.exists().not()'
    bundleProperty: '%resource.version'
    value: [ 'Bundle.entry.resource.ofType(Observation)[%observationIndex].livdTableLookup("LOINC Version ID")' ]

  - name: observation-loinc-device-version
    resource: '%resource.method.union(%resource.extension("https://reportstream.cdc.gov/fhir/StructureDefinition/obx-observation").extension.where(url = "OBX.17").tail().value).coding.where(extension("https://reportstream.cdc.gov/fhir/StructureDefinition/cwe-coding").value = "coding")'
    condition: '%resource.code.exists()'
    bundleProperty: '%resource.code'
    value: [ '%resource.code + "_" + Bundle.entry.resource.ofType(Observation)[0].livdTableLookup("Testkit Name ID Type")' ]