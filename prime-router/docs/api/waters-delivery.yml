openapi: "3.0.3"
info:
  title: ReportStream Delivery API
  description: This API reflects the point of view of the STLTs and provides lookup functionality
  version: "1.0"
  contact:
    name: USDS at Centers for Disease Control and Prevention
    url: https://open.cdc.gov
    email: usds@cdc.gov
  license:
    name: Creative Commons Zero v1.0 Universal
    url: https://github.com/CDCgov/prime-reportstream/blob/master/LICENSE
servers:
  - url: https://prime.cdc.gov/api
    description: Production server (uses live data)
  - url: http://localhost:7071/api
    description: Developer Environment
paths:
  /waters/{organization}/deliveries:
    get:
      operationId: getAvailableReports
      summary: Get available reports for a STLT
      description: Retrieve a list of reports available for download by a STLT
      security:
        - OAuth2: [ user ]
        - Server2Server: []
      parameters:
        - name: organization
          in: path
          description: receiver whose reports we want to see
          required: true
          schema:
            type: string
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/sortDir'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/sortColumn'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/cursor'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/since'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/until'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/pageSize'
      responses:
        '200':
          description: a list of AvailableReport objects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvailableReportsResponse'
        '400':
          description: bad request
        '401':
          description: unauthorized
        '404':
          description: organization does not exist
components:
  securitySchemes:
    OAuth2:
      $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/security_schemes.yml#/OAuth2'
    Server2Server:
      $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/security_schemes.yml#/Server2Server'
  schemas:
    AvailableReportsResponse:
      type: array
      items:
        $ref: '#/components/schemas/AvailableReport'
    AvailableReport:
      type: object
      properties:
        reportId:
          description: the uuid for this report
          type: string
          format: uuid
        dateSent:
          description: when this report was sent
          type: string
          format: date-time
        itemCount:
          description: number of items/tests in the report
          type: integer
        bodyFormat:
          description: file type of the report
          type: string
          enum: [CSV, HL7]
        receivingOrg:
          description: the name of the organization receiving the report
          type: string
        receivingOrgSvc:
          description: service used by the organization
          type: string
        externalName:
          description: the filename for the sent report
          type: string
