openapi: "3.0.3"
info:
  title: ReportStream Delivery-Detail API
  description: This API provides report detail and associated facilities list lookup functionalty
  version: "1.0"
  contact:
    name: USDS at Centers for Disease Control and Prevention
    url: https://open.cdc.gov
    email: usds@cdc.gov
  license:
    name: Creative Commons Zero v1.0 Universal
    url: https://github.com/CDCgov/prime-reportstream/blob/master/LICENSE
servers:
  - url: https://prime.cdc.gov
    description: Production server (uses live data)
  - url: http://localhost:7071
    description: Developer Environment
paths:
  /api/waters/{reportId}/deliveries:
    get:
      operationId: getReportDetails
      summary: Get details for a single report and also list associated facilities
      description: Retrieve the details for a report and list facilities that contributed to that report
      security:
        - OAuth2: [ user ]
        - Server2Server: []
      parameters:
        - name: reportId
          in: path
          description: ID of report whose details we want to see
          required: true
          schema:
            type: string
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/sortDir'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/sortColumn'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/cursor'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/since'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/until'
        - $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/sort_and_filter.yml#/pageSize'
      responses:
        '200':
          description: a report detail object which includes an array of facilities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeliveryDetailSections'
        '400':
          description: bad request
        '401':
          description: unauthorized
        '404':
          description: organization does not exist
components:
  securitySchemes:
    OAuth2:
      $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/security_schemes.yml#/OAuth2'
    Server2Server:
      $ref: 'https://raw.githubusercontent.com/CDCgov/prime-reportstream/master/prime-router/docs/api/components/security_schemes.yml#/Server2Server'
  schemas:
    DeliveryDetailSections:
      type: object
      properties:
        DeliveryDetails:
          type: object
          properties:
            sent:
              description: the timestamp for this report was sent
              type: string
              format: date-time
            via:
              description: how the report was originally sent
              type: string
            total:
              description: total number of reports
              type: integer
            fileType:
              description: how the file is encoded
              type: string
            type:
              description: defines if the report is "full ELR"
              enum: [ELR]
            reportId:
              description: the uuid for this report
              type: string
              format: uuid
            expires:
              description: the timestamp for this report expires
              type: string
              format: date-time
            sendingOrg:
              description: the name of the organization sending the report
              type: string
            receivingOrg:
              description: the name of the organization receiving the report
              type: string
            receivingOrgSvc:
              description: what the receiving org is expecting to receive
              type: string
            facilities:
              description: list of facilities that contributed to the report
              type: array
              items:
                type: string
            actions:
              description: list of actions
              type: array
              items:
                type: string
            displayName:
              description: what text to display to identify the type of report
              type: string
            content:
              description: the full content of the report
              type: string
            fileName:
              description: the name of the file for the report
              type: string
            mimeType:
              description: HTTP format for internet (web) media transport
              type: string
        FacilitiesList:
          type: array
          items:
            $ref: '#/components/schemas/Facility'
    Facility:
      type: object
      properties:
        facility:
          description: the full name of the facility
          type: string
        location:
          description: city and state of the facility
          type: string
        CLIA:
          description: The CLIA number (10-digit alphanumeric) of the facility
          type: string
        positive:
          description: the result (conclusion) of the test. 0 = negative (good usually)
          type: integer
        total:
          description: number of facilities included in the object
          type: integer
