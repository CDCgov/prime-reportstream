openapi: 3.0.1
info:
  title: Prime ReportStream
  description: A router of public health data from senders to receivers
  contact:
    name: USDS at Centers for Disease Control and Prevention
    url: https://reportstream.cdc.gov
    email: "email: reportstream@cdc.gov"
  version: 0.2.0-oas3
paths:
  /settings/organizations/{organizationName}/public-keys/{scope}/{kid}:
    delete:
      tags:
      - Public Key Management
      summary: Delete API key
      description: "Delete API key given org, scope, and kid"
      operationId: delete
      requestBody:
        content:
          '*/*':
            schema:
              $ref: '#/components/schemas/HttpRequestMessageString'
      responses:
        "401":
          description: Unauthorized
        "404":
          description: "Org, scope, or KID not found"
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeysResponse'
      security:
      - primeSecurity: []
  /settings/organizations/{organizationName}/public-keys:
    get:
      summary: Retrieve API keys (deprecated use v1 version)
      operationId: get
      parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          '*/*':
            schema:
              $ref: '#/components/schemas/HttpRequestMessageString'
      responses:
        "200":
          description: API keys returned
        "404":
          description: API key not found
        "400":
          description: Bad request
    post:
      summary: Create (post) an API key for the organization
      description: Create API key for the given organization
      operationId: post
      requestBody:
        content:
          '*/*':
            schema:
              $ref: '#/components/schemas/HttpRequestMessageString'
      responses:
        "200":
          description: API key created
        "401":
          description: Unauthorized operation
  /v1/settings/organizations/{organizationName}/public-keys:
    get:
      summary: "Retrieve API keys for the organization (v1), return API keys when\
        \ successful"
      description: Retrive API key(s) for the given organization
      operationId: getV1
      requestBody:
        content:
          '*/*':
            schema:
              $ref: '#/components/schemas/HttpRequestMessageString'
      responses:
        "200":
          description: API keys returned
        "404":
          description: API key not found
        "400":
          description: Bad request
components:
  schemas:
    ApiKeysResponse:
      type: object
      properties:
        orgName:
          type: string
        keys:
          type: array
          items:
            $ref: '#/components/schemas/JwkSet'
    Jwk:
      type: object
      properties:
        kty:
          type: string
        use:
          type: string
        keyOps:
          type: string
        alg:
          type: string
        kid:
          type: string
        x5u:
          type: string
        x5c:
          type: array
          items:
            type: string
        x5t:
          type: string
        "n":
          type: string
        e:
          type: string
        d:
          type: string
        crv:
          type: string
        p:
          type: string
        q:
          type: string
        dp:
          type: string
        dq:
          type: string
        qi:
          type: string
        x:
          type: string
        "y":
          type: string
        k:
          type: string
    JwkSet:
      type: object
      properties:
        scope:
          type: string
        keys:
          type: array
          items:
            $ref: '#/components/schemas/Jwk'
    HttpResponseMessage:
      type: object
      properties:
        statusCode:
          type: integer
          format: int32
        body:
          type: object
        status:
          $ref: '#/components/schemas/HttpStatusType'
    HttpStatusType:
      type: object
    HttpRequestMessageString:
      type: object
      properties:
        headers:
          type: object
          additionalProperties:
            type: string
        httpMethod:
          type: string
          enum:
          - GET
          - HEAD
          - POST
          - PUT
          - DELETE
          - CONNECT
          - OPTIONS
          - TRACE
          - PATCH
        queryParameters:
          type: object
          additionalProperties:
            type: string
        body:
          type: string
        uri:
          type: string
          format: uri
  securitySchemes:
    primeSecurity:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://hhs-prime.okta.com/oauth/authorize
          tokenUrl: https://hhs-prime.okta.com/oauth/token
          scopes:
            org_admin: Grants write access to single org
            system_admin: Grants access to admin operations
            user: Grants read access
