paths:          
  /waters/report/{reportId}/history/etorMetadata:
    get:
      operationId: getWatersReportHistoryEtorMetadata
      summary: Retrieves ETOR metadata for a sender's report
      description: Fetches the ETOR intermediary's metadata given the sender's report ID.
      parameters:
        - name: reportId
          in: path
          required: true
          description: The unique identifier of the report.
          schema:
            type: string
      responses:
        '200':
          description: Successful retrieval of ETOR metadata.
          content:
            application/json:
              schema:
                $ref: 'components/fhir.yaml#/components/schemas/OperationOutcome'
        '400':
          $ref: 'components/responses.yaml#/BadRequest'
        '404':
          description: lookup Id not found
        '500':
          description: Internal server error.
        default:
          $ref: 'components/responses.yaml#/BadRequest'

  /waters/org/{organization}/submissions:
    get:
      operationId: getWatersOrgSubmissions
      summary: returns a list of simple submissions for a specific sender
      description: returns a list of simple submissions for a specific sender
      parameters:
        - name: organization
          in: path
          description: sender of the report history we want to look at
          required: true
          schema:
            type: string
        - $ref: 'components/sort_and_filter.yaml#/sortDir'
        - $ref: 'components/sort_and_filter.yaml#/sortCol'
        - $ref: 'components/sort_and_filter.yaml#/cursor'
        - $ref: 'components/sort_and_filter.yaml#/since'
        - $ref: 'components/sort_and_filter.yaml#/until'
        - $ref: 'components/sort_and_filter.yaml#/pagesize'
        - name: showFailed
          in: query
          description: whether or not to show submissions that failed delivery
          schema:
            type: boolean
      responses:
        '200':
          description: a list of submission history objects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionHistoryList'
        '400':
          $ref: 'components/responses.yaml#/BadRequest'
        default:
          $ref: 'components/responses.yaml#/BadRequest'

  /waters/org/{organization}.{sender}/submissions:
    get:
      operationId: getWatersOrgSenderSubmissions
      summary: returns a list of simple submissions for a specific sender and sender channel
      description: returns a list of simple submissions for a specific sender and sender channel
      parameters:
        - name: organization
          in: path
          description: sender of the report history we want to look at
          required: true
          schema:
            type: string
        - name: sender
          in: path
          description: sender channel of the report history we want to look at
          required: true
          schema:
            type: string
        - $ref: 'components/sort_and_filter.yaml#/sortDir'
        - $ref: 'components/sort_and_filter.yaml#/sortCol'
        - $ref: 'components/sort_and_filter.yaml#/cursor'
        - $ref: 'components/sort_and_filter.yaml#/since'
        - $ref: 'components/sort_and_filter.yaml#/until'
        - $ref: 'components/sort_and_filter.yaml#/pagesize'
        - name: showFailed
          in: query
          description: whether or not to show submissions that failed delivery
          schema:
            type: boolean
      responses:
        '200':
          description: a list of submission history objects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionHistoryList'
        '400':
          $ref: 'components/responses.yaml#/BadRequest'
        default:
          $ref: 'components/responses.yaml#/BadRequest'
          
  /waters/report/{id}/history:
      get:
        operationId: getWatersReportHistory
        summary: return detailed history of a single submitted report
        description: return detailed history of a single submitted report
        parameters:
          - name: id
            in: path
            description: a valid UUID or actionId (aka submissionId)
            required: true
            schema:
              type: string
        responses:
          '200':
            description: the detailed report history object
            content:
              application/json:
                schema:
                  $ref: 'components/submission.yaml#/schemas/DetailedSubmissionHistory'
          '400':
            $ref: 'components/responses.yaml#/BadRequest'
          '401':
            description: unauthorized
          '404':
            description: either there is no report with the given id or the report is not a submission
          '500':
            description: unable to fetch history due to Data Access Exception
          default:
            $ref: 'components/responses.yaml#/BadRequest'

components:
  schemas:
    SubmissionHistoryList:
      type: array
      items:
        $ref: '#/components/schemas/SubmissionHistory'
    SubmissionHistory:
      type: object
      properties:
        submissionId:
          description: the ID for this submission
          type: integer
        timestamp:
          description: the timestamp for this report submission
          type: string
          format: date-time
        sender:
          description: the name of the sender account
          type: string
        httpStatus:
          description: response given to the sender upon submission
          type: integer
        id:
          description: the report uuid of this submission
          type: string
          format: uuid
        topic:
          description: the schema topic (e.g. COVID-19, Flu)
          type: string
        reportItemCount:
          description: total number of individual reports sent to the Hub (in a csv, the number of data lines sent)
          type: integer
        externalName:
          description: custom report name if one was specified by the sender
          type: string
        fileName:
          description: the filename for the delivered report
          type: string
        fileType:
          description: format in which the report was originally sent
          type: string
          enum: [ INTERNAL, CSV, CSV_SINGLE, HL7, HL7_BATCH, FHIR ]
